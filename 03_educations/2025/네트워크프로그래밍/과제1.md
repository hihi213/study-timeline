

**âœ… 0. ê¸°ë³¸ ì„¤ëª…**

```
int sockfd = socket(AF_INET, SOCK_STREAM, 0);
```

â€¢ AF_INET: IPv4

â€¢ SOCK_STREAM: TCP

â€¢ 0: ìë™ìœ¼ë¡œ TCP ì„ íƒë¨

  

ì´ ì½”ë“œëŠ” **ì†Œì¼“ì„ ìƒì„±**í•˜ê³ , **íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°(sockfd)**ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

---

**âœ… 1. ìœ ì € ê³µê°„ì—ì„œ ì‹œìŠ¤í…œ ì½œ ì§„ì…**

  

**ğŸ“Œ ì†Œì¼“ API í˜¸ì¶œ**

```
socket(AF_INET, SOCK_STREAM, 0);
```

ëŠ” ì‚¬ì‹¤ glibcì—ì„œ ì œê³µí•˜ëŠ” ë˜í¼ í•¨ìˆ˜ì´ê³ , ë‚´ë¶€ì ìœ¼ë¡œëŠ” ì‹œìŠ¤í…œ ì½œì¸ socket() ë˜ëŠ” socketcallì„ í˜¸ì¶œí•©ë‹ˆë‹¤.

  

**ğŸ§  ì‹¤ì œ ì‹œìŠ¤í…œ ì½œë¡œ ë„˜ì–´ê°**

â€¢ x86_64ì—ì„œëŠ” socket()ì€ sys_socket()ì´ë¼ëŠ” ì‹œìŠ¤í…œ ì½œë¡œ ì—°ê²°ë¨

â€¢ ì‹œìŠ¤í…œ ì½œ ë²ˆí˜¸(__NR_socket)ë¥¼ í†µí•´ ì»¤ë„ì— ì „ë‹¬ë¨

---

**âœ… 2. ì»¤ë„ ê³µê°„ ì§„ì…: ì‹œìŠ¤í…œ ì½œ ì²˜ë¦¬ íë¦„**

  

**ğŸ” ì‹œìŠ¤í…œ ì½œ ì²˜ë¦¬ íë¦„ (ë¦¬ëˆ…ìŠ¤ ì»¤ë„ ë‚´ë¶€)**

```
socket()
 â””â”€> __sys_socket()
      â””â”€> sock_create()
           â””â”€> __sock_create()
                â”œâ”€> sock_alloc()
                â”œâ”€> sock->ops = &inet_stream_ops
                â””â”€> sk = inet_create()
```

  

---

**âœ… 3. ê° í•¨ìˆ˜ì˜ ì—­í•  (ì¤‘ìš” í•¨ìˆ˜ ìœ„ì£¼ ì •ë¦¬)**

  

**âœ… __sys_socket()**

â€¢ ì»¤ë„ ì§„ì… í›„ ì²« ì²˜ë¦¬ í•¨ìˆ˜

â€¢ ì†Œì¼“ì˜ ë„ë©”ì¸, íƒ€ì…, í”„ë¡œí† ì½œì„ ê²€ì¦

  

**âœ… sock_create()**

â€¢ struct socket êµ¬ì¡°ì²´ë¥¼ ìƒì„±í•˜ê³  ì´ˆê¸°í™”

  

**âœ… __sock_create()**

â€¢ ë‚´ë¶€ì ìœ¼ë¡œ socket->opsë¥¼ ì„¸íŒ…

â€¢ TCPì´ë©´ inet_stream_ops êµ¬ì¡°ì²´ í• ë‹¹

â€¢ inet_create() í˜¸ì¶œ

  

**âœ… inet_create()**

â€¢ TCP ì†Œì¼“ì´ë¼ë©´ tcp_protë¥¼ í• ë‹¹

â€¢ struct sock (ì „ì†¡ ê³„ì¸µ ì œì–´ ë¸”ë¡) ìƒì„±

â€¢ í”„ë¡œí† ì½œ ë³„ ì´ˆê¸°í™” ìˆ˜í–‰ (ì˜ˆ: tcp_init_sock())

  

**âœ… sock_alloc()**

â€¢ ìƒˆë¡œìš´ ì†Œì¼“ êµ¬ì¡°ì²´ í• ë‹¹ (SLAB ë©”ëª¨ë¦¬ ìºì‹œ)

---

**âœ… 4. íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° í• ë‹¹**

  

ë§ˆì§€ë§‰ì—:

```
fd = get_unused_fd_flags(flags);
fd_install(fd, file);  // struct fileì— ì†Œì¼“ ê°ì²´ ì—°ê²°
```

â€¢ ì†Œì¼“ì€ ê²°êµ­ struct fileë¡œ í‘œí˜„ë¨

â€¢ ì´ íŒŒì¼ êµ¬ì¡°ì²´ëŠ” íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° í…Œì´ë¸”ì— ì €ì¥ë¨

---

**âœ… 5. ìµœì¢…ì ìœ¼ë¡œ ì‚¬ìš©ì ê³µê°„ìœ¼ë¡œ ì†Œì¼“ ë””ìŠ¤í¬ë¦½í„° ë°˜í™˜**

```
return fd;  // ex) 3, 4, 5 ë“± ì‚¬ìš© ê°€ëŠ¥í•œ ë””ìŠ¤í¬ë¦½í„° ë²ˆí˜¸
```

  

---

**ğŸ” ì „ì²´ ìš”ì•½ íë¦„**

```
ìœ ì € ê³µê°„
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
socket(AF_INET, SOCK_STREAM, 0)
   â†“
glibc â†’ syscall(SYS_socket)

ì»¤ë„ ê³µê°„
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
__sys_socket()
  â†“
  sock_create()
    â†“
    __sock_create()
      â†“
      sock_alloc()                â† socket êµ¬ì¡°ì²´ ë©”ëª¨ë¦¬ í• ë‹¹
      â†“
      inet_create()              â† TCP í”„ë¡œí† ì½œ ì„¤ì •, sock êµ¬ì¡°ì²´ ì´ˆê¸°í™”
         â†’ tcp_prot ì„¤ì •
         â†’ struct sock ìƒì„± ë° ì—°ê²°
      â†“
      socket->ops ì„¤ì •           â† ì†Œì¼“ ì—°ì‚° í•¨ìˆ˜ í¬ì¸í„° ì—°ê²°

  â†“
  fd = get_unused_fd_flags()     â† ì‚¬ìš© ê°€ëŠ¥í•œ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° í• ë‹¹
  â†“
  fd_install(fd, file)           â† ì†Œì¼“ì„ FDì— ì—°ê²°
  â†“
  return fd                      â† ìµœì¢…ì ìœ¼ë¡œ FD ë¦¬í„´ë¨
```

  

---

**ğŸ“‚ ê´€ë ¨ ì»¤ë„ ì†ŒìŠ¤ íŒŒì¼ ìœ„ì¹˜ (ë¦¬ëˆ…ìŠ¤ ì†ŒìŠ¤ íŠ¸ë¦¬ ê¸°ì¤€)**

|**ì—­í• **|**íŒŒì¼**|
|---|---|
|__sys_socket()|net/socket.c|
|__sock_create()|net/socket.c|
|inet_create()|net/ipv4/af_inet.c|
|tcp_prot, tcp_init_sock()|net/ipv4/tcp.c|

  

---

**âœ… ì°¸ê³ ë¡œ ìƒì„±ë˜ëŠ” ì£¼ìš” êµ¬ì¡°ì²´ë“¤**

|**êµ¬ì¡°ì²´**|**ì„¤ëª…**|
|---|---|
|struct socket|ì†Œì¼“ì˜ ì „ë°˜ì ì¸ ì •ë³´|
|struct sock|í”„ë¡œí† ì½œ ê´€ë ¨ ì •ë³´ (TCP/UDP ë“±)|
|struct file|íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ì™€ ì—°ê²°ëœ ì»¤ë„ ê°ì²´|
|inet_protosw, proto_ops|í•´ë‹¹ ì†Œì¼“ íƒ€ì…ì— ë”°ë¼ ë™ì‘ ì •ì˜|

  