


  

### **🧭 전체 흐름 구조 (상위 3단계)**

```
1. 시스템 초기화 (관리자 관점)
2. 일반 사용자 이용 흐름
3. 운영 및 예외 처리 (관리자 관점)
```

---

## **🔁 1단계: 시스템 초기화 –** 

## **관리자 최초 셋업 흐름**

|**단계**|**설명**|**필요한 기능**|
|---|---|---|
|1-1|기관 또는 공간 단위 시스템 초기화|기관(기숙사) 정보 등록, 위치(동/층/호실 등) 정의|
|1-2|관리자 계정 생성|역할(Role), 권한, 계정 상태 관리|
|1-3|기기 등록|기기명, 위치, NFC/QR 정보, 초기 상태 등록|
|1-4|유지보수 시간 등록 (예약 차단 구간)|예약 불가 시간대 사전 등록 기능|
|1-5|사용자 계정 생성/초대|내부 사용자 명단 연동 or 사용자가 직접 가입 (제어 가능)|
|1-6|알림 정책 설정|어떤 이벤트에 알림을 보낼지 사전 정의|

> 🔧 **초기 세팅이 끝나면**, 이제 사용자는 서비스를 이용할 수 있음.

---

## **👤 2단계: 일반 사용자 이용 흐름 –** 

## **일상적 사용 시나리오**

|**단계**|**설명**|**필요한 기능**|
|---|---|---|
|2-1|로그인 / 마이페이지 접근|로그인, 내 예약/신고/알림 확인|
|2-2|기기 목록 확인|위치/상태별 필터, 즐겨찾기 가능|
|2-3|출발해요 요청|중복 예약 차단, DEPARTURE 상태 저장|
|2-4|도착 인증 (NFC/QR)|시간 내 인증 시 ARRIVAL 상태 전환|
|2-5|사용 등록|실제 세탁기 사용 시점, IN_USE 상태 전환|
|2-6|사용 종료|DONE 상태로 전환 (타이머 or 수동)|
|2-7|회수 완료|사용자가 회수 후 직접 AVAILABLE 상태로 변경|
|2-8|이력 조회|완료된 사용 기록 조회|
|예외|도착 인증 실패, 회수 지연|자동 상태 전환 or 알림 전송, 패널티 기록|

---

## **🛠 3단계: 운영 및 예외 처리 –** 

## **관리자 실시간 대응 흐름**

|**단계**|**설명**|**필요한 기능**|
|---|---|---|
|3-1|고장 신고 확인|사용자 신고 접수 → CONFIRMED/RESOLVED 처리|
|3-2|무단 사용 신고 확인|사용자의 신고 처리 및 경고 누적 확인|
|3-3|기기 상태 수동 변경|고장 상태 직접 설정 or 예약 해제 처리|
|3-4|사용자 제재|거짓 신고, 무단 사용 누적 시 수동 조치|
|3-5|알림 발송|자동 or 수동 공지 발송 기능|
|3-6|통계 조회 (추후 확장)|기기 가동률, 사용자 행동 통계 대시보드|

---

## **✅ 1-1. 기관 및 관리자 생성 (MVP)**

  
### **🔹 흐름 요약**
```
신청자 → /admin/request → admin_requests 테이블 저장 (PENDING)
→ 운영자 검토 → 승인 시 users + institutions 테이블에 등록
```
### **📌 관련 기능**

|**기능**|**설명**|**처리 방식**|**테이블**|
|---|---|---|---|
|관리자 신청 제출|기관명, 이메일, 사용 목적 등 입력 후 제출|웹 폼 → DB 저장|admin_requests|
|상태 표시|신청 상태: PENDING / APPROVED / REJECTED|상태 변경 시 이메일 발송도 가능|admin_requests.status|
|관리자 승인|운영자가 승인하면 실제 관리자 계정 생성됨|관리 콘솔 or 직접 SQL 처리|users, institutions|
|승인 후 알림|승인 결과 알림 전송 (선택)|notifications 사용 가능|notifications|

### **📁 DB 구조:** 

### **admin_requests**

```
CREATE TABLE admin_requests (
    id INT PRIMARY KEY AUTO_INCREMENT,
    institution_name VARCHAR(100) NOT NULL,
    email VARCHAR(100) NOT NULL,
    purpose TEXT,
    status ENUM('PENDING', 'APPROVED', 'REJECTED') DEFAULT 'PENDING',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

→ APPROVED 시점에 users, institutions 테이블에 데이터 이관

---

## **🧭 향후 확장 (참고 기록용)**

|**확장안**|**핵심 내용**|
|---|---|
|기관 이메일 도메인 필터링|email LIKE %@dorm.hanyang.ac.kr 조건으로 제한 가능|
|초대 기반 생성|/admin/invite?token=abc123 → 가입 후 자동 APPROVED|

---

다음은 1-2. **관리자 초기 설정** (기기/공간 등록 전 세팅)으로 넘어갈게.

준비되면 “1-2 점검하자”라고 알려줘도 되고, 수정하고 싶은 흐름 있으면 언제든 말해줘!

좋아, 그럼 이제 **1-2. 관리자 초기 설정**을 아래 기준으로 꼼꼼하게 점검해보자:

---

## **✅ 1-2. 관리자 초기 설정**

  

> 관리자 계정이 승인된 이후, 시스템 운영을 위해 반드시 필요한 초기 구성 흐름

---

### **📌 기능 정의**

  

#### **주요 목적**

- 기관별 **기본 공간 구조(동, 층, 호실)** 등록
    
- 사용할 **기기(세탁기/건조기 등)** 등록
    
- 예약 가능 여부에 영향을 주는 **예약 불가 시간대** 설정
    

  

#### **실제 흐름**

```
승인된 관리자 → 로그인 → 공간 구조 등록 → 기기 등록 → 유지보수 시간 설정
```

---

### **✅ 세부 기능 정의 및 점검**

| **기능**      | **설명**                                | **필수 여부**  | **예외 사항**                                   |
| ----------- | ------------------------------------- | ---------- | ------------------------------------------- |
| 공간(위치) 등록   | 기관 내 ‘동’, ‘층’, ‘호실’ 등으로 구분되는 공간 구조 등록 | ✅          | 공간 중복명 방지 필요 (institution_id + name UNIQUE) |
| 기기 등록       | 각 공간에 기기 등록 (기기명, NFC, 초기 상태 포함)      | ✅          | 위치 누락/중복, 초기 상태 오류 (예: FAULT로 시작) 방지        |
| 예약 불가 시간 설정 | 특정 시간대 기기 예약 차단 (점검용)                 | ✅          | 시간 중복, 과거 시간 등록 등 유효성 검증 필요                 |
| 기기 상태 수동 설정 | 초기 세팅 시 기기를 특정 상태로 수동 지정 가능           | 🕒 (후속 가능) | FAULT/OUT_OF_SERVICE 설정 초기화 가능              |

---

### **🗃 관련 DB 테이블 구조 (예시 요약)**

  

#### **1.** 

#### **locations**

```
CREATE TABLE locations (
    id INT PRIMARY KEY AUTO_INCREMENT,
    institution_id INT NOT NULL,
    name VARCHAR(50) NOT NULL,  -- 예: 1동 3층
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY uniq_location (institution_id, name)
);
```

#### **2.** 

#### **devices**

```
CREATE TABLE devices (
    id INT PRIMARY KEY AUTO_INCREMENT,
    device_name VARCHAR(50) NOT NULL,
    location_id INT NOT NULL,
    status ENUM('AVAILABLE', 'IN_USE', 'DONE', 'FAULT_REPORTED', 'UNAUTHORIZED_USE', 'OUT_OF_SERVICE') DEFAULT 'AVAILABLE',
    nfc_tag_url VARCHAR(255),
    qr_code_url VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### **3.** 

#### **devices_maintenance**

```
CREATE TABLE devices_maintenance (
    id INT PRIMARY KEY AUTO_INCREMENT,
    device_id INT NOT NULL,
    start_time DATETIME NOT NULL,
    end_time DATETIME NOT NULL,
    reason TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

### **🚨 예외 상황 점검**

| **예외 상황**         | **대응 방법**                                              |
| ----------------- | ------------------------------------------------------ |
| 공간 미지정 상태에서 기기 등록 | 공간 리스트가 비어 있을 경우 등록 불가 처리                              |
| 기기명 중복            | 동일 위치 내에서 중복 방지 (location_id, device_name 조합으로 UNIQUE) |
| 유지보수 시간 등록 오류     | 시작 시간 > 종료 시간, 중복 시간대 등 검증 필요                          |
| NFC 태그 누락         | MVP에서는 URL 직접 생성 가능하므로 필수는 아님 (입력 옵션 처리)               |

---

### **🧠 UX 설계 고려**

- 공간 구조 → 드롭다운 또는 트리 형태로 표현
    
- 기기 상태를 색상 아이콘으로 표시
    
- 예약 불가 시간 설정 시 캘린더/시계 UI 활용
    
- ❗예약 불가 시간은 기기별 반복 패턴이 필요할 수 있음 (매주 화요일 13~15시 등 → 확장 고려)
    

---

## **✅ 1-2 최종 점검 요약**

|**항목**|**상태**|**비고**|
|---|---|---|
|기능 정의|✅ 충분히 정리됨||
|예외 상황|✅ 예상 오류 정의됨||
|DB 연계|✅ 명확||
|API 설계 가능성|✅ CRUD 흐름 명확함||
|확장 포인트|🕒 반복 예약 불가 시간 패턴, 상태별 기본 세팅 기능 등||

---

이제 **1-3 사용자 등록/초대 흐름**으로 넘어가도 괜찮을까?
























- 사용자기능

| **기능**         | **설명**                         |
| -------------- | ------------------------------ |
| ✅ 기기 상태 확인     | 사용 가능 / 사용 중 / 고장 상태 확인        |
| ✅ 사용 등록        | 빈 기기 선택 → 예상 사용 시간 입력 → 등록     |
| ✅ 사용 종료 / 회수   | 사용 후 완료 표시 → 회수 시간 기록          |
| ✅ 무단 사용 신고     | 비등록 상태 기기 사용 시 신고 가능           |
| ✅ 남은 시간 기록     | 무단 사용 중 기기에 남은 시간 수동 입력        |
| ✅ 알림 수신        | 예약 완료, 종료 임박, 공지 등 웹 알림 수신     |
| ✅ 알림 확인        | 접속 시 공지 팝업, 알림센터에서 확인          |
| ✅ 사용 내역 보기     | 자신의 등록 내역 및 회수 상태 확인           |
| ✅ 로그인 / 자동 로그인 | PWA에서 자동 로그인 (localStorage 기반) |

- 사용자 행동시나리오 기반 기능정리

| 사용자 행동              | 시스템 동작                                 | 관련 관리자 기능                         |
| ------------------- | -------------------------------------- | --------------------------------- |
| 기기 사용 시작            | 사용 등록 (예상 시간 입력) → 상태 `IN_USE` 전환      | 권한 확인 / 상태 기록 / 로그 저장             |
| 기기 사용 종료            | 사용 종료 버튼 → 회수 시간 자동입력 → 상태 `DONE`      | 회수율 반영 / 예약 통계 증가                 |
| 남이 무단 사용 중임         | 무단 사용 신고 → 상태 `SUSPECTED_IN_USE`       | 피신고자 기록 / 거짓신고 확인 / 경고 누적         |
| 내가 등록하지 않은 기기지만 돌아감 | 남은 시간 입력 → 상태 `IN_USE_UNREGISTERED`    | 관리자 확인 필요 알림 생성                   |
| 내 사용 내역 보기          | 사용 내역 조회 (상태/회수 포함)                    | 통계 반영, 사용자 활동 기록 열람               |
| 공지/알림 확인            | 접속 시 팝업 + 알림센터 내역 확인                   | 관리자 공지 작성/발송 로그 확인                |
| 고장신고                | 고장 신고 → 기기 상태 FAULT_REPORTED (신고 접수 중) | 관리자 접수 시 상태 FAULT_CONFIRMED 으로 전환 |
|                     |                                        |                                   |

---


    
- 관리자기능

| **기능**                    | **설명**                           |
| ------------------------- | -------------------------------- |
| ✅ 기기 등록 / 수정 / 삭제         | 공간 단위로 세탁기/건조기 관리                |
| ✅ 고장 처리                   | 고장 신고 기기 수리 상태 변경                |
| ✅ 권한 설정 (Room → Location) | 사용자 권한 배정 및 fallback/override 설정 |
| ✅ 사용자 관리                  | 사용자 목록 필터링, 상태 확인                |
| ✅ 관리자 계정 관리               | 계정 생성 / 비활성화 / 역할 변경             |
| ✅ 알림 작성 및 발송              | 특정 사용자 또는 전체 대상 공지 발송            |
| ✅ 통계 확인                   | 예약 수, 고장 수, 회수율 등 통계 확인          |
| ✅ 감사 로그 확인                | 관리자 행동 이력 확인 (AdminActionLog)    |
| Nfc 기기별 사용 가능여부 설정        |                                  |

- 관리자 행동흐름 기준 기능

|              |                                                         |
| ------------ | ------------------------------------------------------- |
| 관리자 행동       | 관련 기능 흐름                                                |
| 기기 설치        | 기기 등록 → 공간(Location) 지정 → 초기 상태 설정                      |
| 기기 고장 접수     | 고장 신고 상태 FAULT_REPORTED 확인 → 접수 시 상태 FAULT_CONFIRMED 변경 |
| 고장 처리 완료     | 상태 복구 (`AVAILABLE`) → 관리자 로그 기록                         |
| 사용자 권한 요청 처리 | Room → Location 권한 재배정 or override 설정                   |
| 회수율 모니터링     | 회수율/신고율/사용률 통계 확인 페이지 접속                                |
| 관리자 계정 관리    | 계정 생성/비활성화/역할 부여 → 상태/로그인 제한 적용                         |
| 정기 점검        | `last_login_at` 기준 미사용 관리자 파악 → 상태 변경 or 알림 발송          |
| 시스템 공지 작성    | Notification 생성 → 사용자 알림센터 + 팝업 전달                      |


---

## **🔁 공통 기능**

|**기능**|**설명**|
|---|---|
|✅ 로그인 / 인증 처리|JWT + role 기반 인증 처리|
|✅ 알림 수신 처리|PWA + Service Worker 알림 등록|
|✅ 권한 검사|role, institution_id 기반 API 접근 제어|
|✅ last_login_at 기록|로그인 시점 자동 업데이트|
|✅ 상태 동기화|예약 상태 자동 갱신 / 기기 상태 갱신 로직 포함|
- JWT 기반 로그인 + `role` 체크
    
- 모든 주요 테이블에 `institution_id` 포함 (멀티테넌시 구조)
    
- `AdminActionLog` 기록 구조 반영 (기기/권한/알림 관련 행동)
    
- 알림 구조: 웹 푸시 기반, 추후 카카오/밴드 등 확장 가능
    
- Soft Delete (`deleted_at`) 기반 삭제 설계 적용
 - 역할 기반 분리 예시

|**사용자 유형**|**기능 권한**|
|---|---|
|일반 사용자|사용 등록, 회수, 신고, 알림 확인|
|관리자 (MANAGER)|기기/고장/권한 관리, 일부 알림 가능|
|최고 관리자 (SUPER_ADMIN)|모든 권한, 계정 생성/관리, 감사 로그 확인|

  
### **[사용자 기능]**

| **기능**                | **설명**                                                                     |
| --------------------- | -------------------------------------------------------------------------- |
| **1. 로그인/로그아웃**       | - 사용자 로그인 / 로그아웃- PWA로 로그인 상태 유지 (localStorage)                            |
| **2. 출발해요**           | - 기기 선택 후 출발해요 신청- 10분간 도착 대기 상태로 전환- 도착하지 않으면 자동 취소 30분간 출발해요 기능 사용 불가    |
| **3. 도착해요 (NFC인증)**   | - NFC 스캔으로 도착해요 확인- NTAG 424 DNA 동적 URL로 사용자 인증- 인증 완료 시, 사용 등록 가능         |
| **4. 사용 등록**          | - 도착해요 완료 후, 사용 시간 설정 및 등록- 사용 시간 등록 시, 기기 상태 IN_USE로 전환                   |
| **5. 사용 종료 (회수 완료)**  | - 사용 완료 시, 사용 종료 버튼 클릭- 기기 상태를 DONE으로 변경하고 회수 시간 기록                        |
| **6. 무단 사용 신고**       | - 기기가 사용 중이 아닌데 사용 중으로 표시된 경우- 무단 사용 신고 가능- 관리자는 해당 신고를 검토하고, 무단 사용 상태로 전환 |
| **7. 상태 이상 신고**       | - 기기 고장 또는 상태 이상 발견 시 신고- 신고 상태 FAULT_REPORTED로 전환                         |
| **8. 내 기기 확인**        | - 현재 사용 중인 기기 목록 확인- 사용 시간, 남은 시간 표시                                       |
| **9. 알림 확인 (PWA 푸시)** | - 예약 시간 종료, 무단 사용 신고 등 주요 알림 수신- PWA 푸시 알림 및 알림센터에서 확인                     |
| **10. 마이페이지**         | - 사용자 정보 확인 및 비밀번호 변경- 내 신고 내역 / 내 기기 목록 확인                                |

---

### **✅** 

### **[관리자 기능]**

|**기능**|**설명**|
|---|---|
|**1. 관리자 로그인**|- 관리자 전용 로그인 화면|
|**2. 기기 등록/수정/삭제**|- 기기 정보 등록 (위치, 기기명, NFC/QR URL)- 기기 상태 변경 (AVAILABLE, IN_USE, FAULT_REPORTED)|
|**3. 출발해요 / 도착해요 관리**|- 출발해요 대기 중인 사용자 목록 확인- 도착해요 상태 강제 승인|
|**4. 무단 사용 신고 관리**|- 무단 사용 신고 내역 확인- 사용자에게 경고 알림 전송- 신고 내역 기록|
|**5. 상태 이상 신고 관리**|- 고장 신고 내역 확인- FAULT_CONFIRMED로 전환 후, 수리 진행|
|**6. 사용자 관리**|- 사용자 목록 확인- 특정 사용자 권한 변경- 사용 내역 조회|
|**7. 알림 발송**|- 특정 사용자 또는 전 사용자에게 공지 알림 발송|
|**8. 통계/로그 확인**|- 기기별 사용률, 무단 사용 신고 횟수, 고장 신고 내역 등 통계 제공|
|**9. 대체 권한 설정**|- 특정 기기 또는 공간이 고장난 경우- 임시 권한 부여하여 다른 기기 사용 가능하도록 설정|
|**10. 시스템 점검 모드**|- 전체 기기 상태 일괄 변경 (점검 중, 유지보수 중 등)|






### **✅** 

### **[알림 정책]**

| **이벤트**                                  | **알림 내용**                                 | **알림 대상** |
| ---------------------------------------- | ----------------------------------------- | --------- |
| **출발해요 대기 시작** (이미 한명이 있을시 대기줄 세워~? 말어?) | “출발해요가 시작되었습니다. 10분 내에 도착해요를 완료하세요.”      | 사용자       |
| **출발해요 취소됨**                             | “출발해요가 취소되었습니다. 다시 시도해 주세요.”              | 사용자       |
| **도착했어요 시작**                             | “도착했어요가 시작되었습니다. 5분 내에 사용 등록을 완료하세요.”     | 사용자       |
| **사용 등록 완료**                             | “세탁기 사용이 등록되었습니다. 사용 시간을 확인하세요.”          | 사용자       |
| **사용 종료 시간 도래**                          | “사용 시간이 5분 남았습니다. 세탁물을 회수해 주세요.”          | 사용자       |
| **회수 시간 초과**                             | “세탁물 회수 시간이 초과되었습니다. 다른 사용자가 신고할 수 있습니다.” | 사용자       |
| **무단 사용 신고 접수됨**                         | “무단 사용 신고가 접수되었습니다. 사용 내역을 확인해 주세요.”      | 관리자, 사용자  |
| **고장 신고 접수됨**                            | “기기 고장 신고가 접수되었습니다. 관리자에게 보고되었습니다.”       | 관리자, 사용자  |
| **관리자 공지 발송됨**                           | “시스템 점검 공지가 도착했습니다. 확인해 주세요.”             | 전체 사용자    |


외부 알림 연동 (카카오/밴드)|🔄 가능|구조만 준비, 실제 연동은 추후 선택|
