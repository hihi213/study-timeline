


























- 사용자기능

| **기능**         | **설명**                         |
| -------------- | ------------------------------ |
| ✅ 기기 상태 확인     | 사용 가능 / 사용 중 / 고장 상태 확인        |
| ✅ 사용 등록        | 빈 기기 선택 → 예상 사용 시간 입력 → 등록     |
| ✅ 사용 종료 / 회수   | 사용 후 완료 표시 → 회수 시간 기록          |
| ✅ 무단 사용 신고     | 비등록 상태 기기 사용 시 신고 가능           |
| ✅ 남은 시간 기록     | 무단 사용 중 기기에 남은 시간 수동 입력        |
| ✅ 알림 수신        | 예약 완료, 종료 임박, 공지 등 웹 알림 수신     |
| ✅ 알림 확인        | 접속 시 공지 팝업, 알림센터에서 확인          |
| ✅ 사용 내역 보기     | 자신의 등록 내역 및 회수 상태 확인           |
| ✅ 로그인 / 자동 로그인 | PWA에서 자동 로그인 (localStorage 기반) |

- 사용자 행동시나리오 기반 기능정리

| 사용자 행동              | 시스템 동작                                 | 관련 관리자 기능                         |
| ------------------- | -------------------------------------- | --------------------------------- |
| 기기 사용 시작            | 사용 등록 (예상 시간 입력) → 상태 `IN_USE` 전환      | 권한 확인 / 상태 기록 / 로그 저장             |
| 기기 사용 종료            | 사용 종료 버튼 → 회수 시간 자동입력 → 상태 `DONE`      | 회수율 반영 / 예약 통계 증가                 |
| 남이 무단 사용 중임         | 무단 사용 신고 → 상태 `SUSPECTED_IN_USE`       | 피신고자 기록 / 거짓신고 확인 / 경고 누적         |
| 내가 등록하지 않은 기기지만 돌아감 | 남은 시간 입력 → 상태 `IN_USE_UNREGISTERED`    | 관리자 확인 필요 알림 생성                   |
| 내 사용 내역 보기          | 사용 내역 조회 (상태/회수 포함)                    | 통계 반영, 사용자 활동 기록 열람               |
| 공지/알림 확인            | 접속 시 팝업 + 알림센터 내역 확인                   | 관리자 공지 작성/발송 로그 확인                |
| 고장신고                | 고장 신고 → 기기 상태 FAULT_REPORTED (신고 접수 중) | 관리자 접수 시 상태 FAULT_CONFIRMED 으로 전환 |
|                     |                                        |                                   |

---


    
- 관리자기능

| **기능**                    | **설명**                           |
| ------------------------- | -------------------------------- |
| ✅ 기기 등록 / 수정 / 삭제         | 공간 단위로 세탁기/건조기 관리                |
| ✅ 고장 처리                   | 고장 신고 기기 수리 상태 변경                |
| ✅ 권한 설정 (Room → Location) | 사용자 권한 배정 및 fallback/override 설정 |
| ✅ 사용자 관리                  | 사용자 목록 필터링, 상태 확인                |
| ✅ 관리자 계정 관리               | 계정 생성 / 비활성화 / 역할 변경             |
| ✅ 알림 작성 및 발송              | 특정 사용자 또는 전체 대상 공지 발송            |
| ✅ 통계 확인                   | 예약 수, 고장 수, 회수율 등 통계 확인          |
| ✅ 감사 로그 확인                | 관리자 행동 이력 확인 (AdminActionLog)    |
| Nfc 기기별 사용 가능여부 설정        |                                  |

- 관리자 행동흐름 기준 기능

|              |                                                         |
| ------------ | ------------------------------------------------------- |
| 관리자 행동       | 관련 기능 흐름                                                |
| 기기 설치        | 기기 등록 → 공간(Location) 지정 → 초기 상태 설정                      |
| 기기 고장 접수     | 고장 신고 상태 FAULT_REPORTED 확인 → 접수 시 상태 FAULT_CONFIRMED 변경 |
| 고장 처리 완료     | 상태 복구 (`AVAILABLE`) → 관리자 로그 기록                         |
| 사용자 권한 요청 처리 | Room → Location 권한 재배정 or override 설정                   |
| 회수율 모니터링     | 회수율/신고율/사용률 통계 확인 페이지 접속                                |
| 관리자 계정 관리    | 계정 생성/비활성화/역할 부여 → 상태/로그인 제한 적용                         |
| 정기 점검        | `last_login_at` 기준 미사용 관리자 파악 → 상태 변경 or 알림 발송          |
| 시스템 공지 작성    | Notification 생성 → 사용자 알림센터 + 팝업 전달                      |


---

## **🔁 공통 기능**

|**기능**|**설명**|
|---|---|
|✅ 로그인 / 인증 처리|JWT + role 기반 인증 처리|
|✅ 알림 수신 처리|PWA + Service Worker 알림 등록|
|✅ 권한 검사|role, institution_id 기반 API 접근 제어|
|✅ last_login_at 기록|로그인 시점 자동 업데이트|
|✅ 상태 동기화|예약 상태 자동 갱신 / 기기 상태 갱신 로직 포함|
- JWT 기반 로그인 + `role` 체크
    
- 모든 주요 테이블에 `institution_id` 포함 (멀티테넌시 구조)
    
- `AdminActionLog` 기록 구조 반영 (기기/권한/알림 관련 행동)
    
- 알림 구조: 웹 푸시 기반, 추후 카카오/밴드 등 확장 가능
    
- Soft Delete (`deleted_at`) 기반 삭제 설계 적용
 - 역할 기반 분리 예시

|**사용자 유형**|**기능 권한**|
|---|---|
|일반 사용자|사용 등록, 회수, 신고, 알림 확인|
|관리자 (MANAGER)|기기/고장/권한 관리, 일부 알림 가능|
|최고 관리자 (SUPER_ADMIN)|모든 권한, 계정 생성/관리, 감사 로그 확인|

  
### **[사용자 기능]**

| **기능**                | **설명**                                                                     |
| --------------------- | -------------------------------------------------------------------------- |
| **1. 로그인/로그아웃**       | - 사용자 로그인 / 로그아웃- PWA로 로그인 상태 유지 (localStorage)                            |
| **2. 출발해요**           | - 기기 선택 후 출발해요 신청- 10분간 도착 대기 상태로 전환- 도착하지 않으면 자동 취소 30분간 출발해요 기능 사용 불가    |
| **3. 도착해요 (NFC인증)**   | - NFC 스캔으로 도착해요 확인- NTAG 424 DNA 동적 URL로 사용자 인증- 인증 완료 시, 사용 등록 가능         |
| **4. 사용 등록**          | - 도착해요 완료 후, 사용 시간 설정 및 등록- 사용 시간 등록 시, 기기 상태 IN_USE로 전환                   |
| **5. 사용 종료 (회수 완료)**  | - 사용 완료 시, 사용 종료 버튼 클릭- 기기 상태를 DONE으로 변경하고 회수 시간 기록                        |
| **6. 무단 사용 신고**       | - 기기가 사용 중이 아닌데 사용 중으로 표시된 경우- 무단 사용 신고 가능- 관리자는 해당 신고를 검토하고, 무단 사용 상태로 전환 |
| **7. 상태 이상 신고**       | - 기기 고장 또는 상태 이상 발견 시 신고- 신고 상태 FAULT_REPORTED로 전환                         |
| **8. 내 기기 확인**        | - 현재 사용 중인 기기 목록 확인- 사용 시간, 남은 시간 표시                                       |
| **9. 알림 확인 (PWA 푸시)** | - 예약 시간 종료, 무단 사용 신고 등 주요 알림 수신- PWA 푸시 알림 및 알림센터에서 확인                     |
| **10. 마이페이지**         | - 사용자 정보 확인 및 비밀번호 변경- 내 신고 내역 / 내 기기 목록 확인                                |

---

### **✅** 

### **[관리자 기능]**

|**기능**|**설명**|
|---|---|
|**1. 관리자 로그인**|- 관리자 전용 로그인 화면|
|**2. 기기 등록/수정/삭제**|- 기기 정보 등록 (위치, 기기명, NFC/QR URL)- 기기 상태 변경 (AVAILABLE, IN_USE, FAULT_REPORTED)|
|**3. 출발해요 / 도착해요 관리**|- 출발해요 대기 중인 사용자 목록 확인- 도착해요 상태 강제 승인|
|**4. 무단 사용 신고 관리**|- 무단 사용 신고 내역 확인- 사용자에게 경고 알림 전송- 신고 내역 기록|
|**5. 상태 이상 신고 관리**|- 고장 신고 내역 확인- FAULT_CONFIRMED로 전환 후, 수리 진행|
|**6. 사용자 관리**|- 사용자 목록 확인- 특정 사용자 권한 변경- 사용 내역 조회|
|**7. 알림 발송**|- 특정 사용자 또는 전 사용자에게 공지 알림 발송|
|**8. 통계/로그 확인**|- 기기별 사용률, 무단 사용 신고 횟수, 고장 신고 내역 등 통계 제공|
|**9. 대체 권한 설정**|- 특정 기기 또는 공간이 고장난 경우- 임시 권한 부여하여 다른 기기 사용 가능하도록 설정|
|**10. 시스템 점검 모드**|- 전체 기기 상태 일괄 변경 (점검 중, 유지보수 중 등)|






### **✅** 

### **[알림 정책]**

| **이벤트**                                  | **알림 내용**                                 | **알림 대상** |
| ---------------------------------------- | ----------------------------------------- | --------- |
| **출발해요 대기 시작** (이미 한명이 있을시 대기줄 세워~? 말어?) | “출발해요가 시작되었습니다. 10분 내에 도착해요를 완료하세요.”      | 사용자       |
| **출발해요 취소됨**                             | “출발해요가 취소되었습니다. 다시 시도해 주세요.”              | 사용자       |
| **도착했어요 시작**                             | “도착했어요가 시작되었습니다. 5분 내에 사용 등록을 완료하세요.”     | 사용자       |
| **사용 등록 완료**                             | “세탁기 사용이 등록되었습니다. 사용 시간을 확인하세요.”          | 사용자       |
| **사용 종료 시간 도래**                          | “사용 시간이 5분 남았습니다. 세탁물을 회수해 주세요.”          | 사용자       |
| **회수 시간 초과**                             | “세탁물 회수 시간이 초과되었습니다. 다른 사용자가 신고할 수 있습니다.” | 사용자       |
| **무단 사용 신고 접수됨**                         | “무단 사용 신고가 접수되었습니다. 사용 내역을 확인해 주세요.”      | 관리자, 사용자  |
| **고장 신고 접수됨**                            | “기기 고장 신고가 접수되었습니다. 관리자에게 보고되었습니다.”       | 관리자, 사용자  |
| **관리자 공지 발송됨**                           | “시스템 점검 공지가 도착했습니다. 확인해 주세요.”             | 전체 사용자    |


외부 알림 연동 (카카오/밴드)|🔄 가능|구조만 준비, 실제 연동은 추후 선택|
