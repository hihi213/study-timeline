**세탁기 알림웹사이트**
- 세탁-> 남자/여자/이불 3중 선택-> 세탁기탭, 건조기탭 누르면 세탁기 모형 나열되어있고
- 돌리고 있으면 빨간색/ 남은 시간 써있음
- 돌리려고 한다면 세탁기 클릭하고 몇분돌리는지/고장났다고 설정
- 다 돌리기 몇분전에 알림줄지 옵션 클릭
- 가져갔다면 도어스토퍼 설치해주세요!
- 먼지 제거해주세요

  

웹의 문제점
사용자가 직접 웹사이트에 접속하고,
여러 조건(남자/여자/세탁기/건조기 등)을 선택해야 하는 과정이 복잡함
• 사용자가 세탁기를 확인하거나 등록하려는 단순한 목적에 비해,
설정할 항목이 너무 많아 **진입 장벽이 높아질 수 있음**
• 웹브라우저는 기본적으로 **실시간 알림을 지원하지 않아서**,
세탁 완료 알림이 제대로 전달되지 않을 가능성 있음

  

앱의 문제점
별도의 앱을 설치하는 과정에서 **거부감**이 생길 수 있음
(용량 부족, 귀찮음, 접근성 문제 등)
• 앱 사용자가 일부에 그치게 되면,
전체 시스템의 효과가 떨어지고 **참여율이 낮아질 수 있음**
• **기숙사 내 전원이 자주 바뀌는 구조상**,
앱 설치를 강제하는 구조는 지속 가능성이 낮음

웹의 문제점 헤결
세탁기마다 부착된 **NFC 태그를 터치**하면 자동으로 해당 세탁기 등록 화면으로 이동하게 해 과정 단순화
카카오 알림톡 연동

카카오톡 연동의 문제
**일부 사용자들은 개인정보 제공이나 로그인 과정 때문에 거부감** 느낄 수 있다

카카오톡 문제 해결
채널톡으로 자동메세지 발송
채널톡만 친구추가하고

채널톡 문제발생
웹에서 구분된 사용자를 카카오톡 채널 사용자를 어떻게 매칭하지

채널톡 문제 해결
사용자가 채널톡에 말을 걸면, 그 순간부터 고유한 사용자 ID가 생성됨
그 ID와 웹사이트사용자를 매칭하면된다 근데 그럴려면 웹사이트 회원가입를 해야하고 그걸 사용자Id랑 매칭해도
웹사이트 사용할때마다 가입하는건 번거롭다

  

회원가입 해결
기숙사생들에겐 호실+개인번호가 부여되어있다. 
웹사이트에서는 호실 개인번호를 입력하면  카카오톡 채널톡의 사용자 Id로 카카오톡 메세지를 보낸다
**호실 + 개인번호와 userId 매칭 테이블 만들기**

  

**카카오톡userid 수집방법**
**채널톡에 특정한 양식으로 자신의 호실번호와 개인번호를 보낸다**
**그러면 추출한 채널톡userId와 매칭하여 db에 저장한다.**

  

이러면 전국의 기숙사들도 사용할수있지 않을까..?
이걸 수정해서 아예 관리자는 기관/학교 추가하고 해당 기숙사 세탁기 몇대인지

세탁이 끝나고 사용자가 따로 행동이 있어야할까?
번거롭지 않을까?
세탁도중에 중지한경우추가해야하고

1. **사용자 ID 생성 및 매칭**
    
    - 사용자가 **카카오톡 채널에 먼저 선톡**을 보내면, **자동으로 사용자 ID**가 생성됩니다.
        
    - 생성된 **사용자 ID**를 바탕으로, **호실 번호**와 **개인 번호**를 매칭하여 **사용자의 고유 ID**를 자동으로 생성합니다.
        
    
2. **세탁기 사용 시간 설정 및 알림**
    
    - 사용자가 웹사이트에 접속한 후, **호실 번호**와 **개인 번호**를 입력하여 사용자 ID와 매칭합니다.
        
    - **세탁기 사용 시간**과 **알림 설정**을 완료한 후, 시스템은 **카카오톡 사용자 ID**를 통해 **자동 메시지**를 전송합니다.
        
    
3. **알림 전송**
    
    - 사용자가 설정한 세탁기 종료 시간에 맞춰 **카카오톡 메시지**로 알림을 자동으로 전송합니다.
하려했는데 카카오 상담톡 API 자체를 제공하여 상담톡을 구축하는 것은 지원하고 있지 않는 점 으로 빢꾸당함


- 세탁기를 예약한 몇시부터 몇시까지 끝나면 바로 뺄수있게 시스템을 만들고 안가져가면 3일이나 5일 동안 세탁기 못쓰게 하는 등 패널티를 부과하는거지!!
- 세탁기 예약할때 밑에 건조기도 사용 할건지 안할건지 체크할수 있도록하면 좋을듯
- 세탁기 15분내 안찾아가면 안찾아간 시간 재서 경고주기
- 밴드api이용해서 세탁기용 글 하나 만들고
	- 댓글로 호출해서 세탁물 가져가라 알림
- 세탁기사이트<->기숙사 웹사이트 배너로 서로 연결
- 그래서 웹사이트로 소셜 로그인 지원하거나 아니면 


문제점
1. 스마트플러그사용/ 진동센서사용/ 수동입력 3가지중 하나 택하기
	- 스마트 플러그: 초기비용 비쌈, 오작동시 세탁기 사용못함
	- 진동센서: 값싼 그러나 오작동 확률 높음
	- 수동입력: 사용자가 귀찮음
2. 스마트 플러그를 하자니 지원이 가능할지 모르겠음 그러니 수동입력으로 가되 나중에 스마트 플러그가 호환될 구조로 만들기.
3. 초기 비용이 적어야 많이 기숙사들 측에서 상용화를 할텐데 그러면 사용자가 수동으로 입력하는 방식으로 하는게 좋지 않을까

문제점: **공간 + 성별 + 층별로 구분된 구조**는 기숙사마다 다를 수 있어서, **확장 가능한 설계**를 해야함
- 사용자 기준에선 내가 사용할수있는 기기만 볼수있게,
- 만약에 세탁기가 그 구역의 세탁기가 고장났을경우 타 범주의 세탁기가 보이고 설정할수있게 해야함.
- -> 사용자들을 기관명별/기기들이 모여있는 공간별/ 공간속접근레벨순으로 부여해 구분하고, 레벨에 따라 공용기기도 사용가능하게하자
	- 이때 기관별로 크게 먼저 나누는 이유는 관리자 입장에서 한 기관만 관리하는게 아니니까.
- -> 그러면 타 구역의 세탁기를 이용해야할때 관리자가
	- 공간,접근레벨을 변경할수있게 기능을 넣자
	- 그러면 사용자는 접근할수있는공간선택-> 그중에서도 권한을 받은 기기들이 묶여서 보이게
- ->관리자 설정
	1. 관리자는 여러 기관을 관리하며 기관별로 구성이 다르다
	
	2. 관리자는 이미 이용자의 필드가 나눠져있는, 기관별로 필드 구성이 다른 테이블을 가지고 있다
	3. 사용자는 그룹에만 속하고, 그룹은 공간과 권한을 연결한다
- ->관리자 입장에서 5단계
	- 관리 기관추가
	- 기기들이 설치된 공간 추가
	- 기기유형 추가
	- 기기 개수 선택-> 자동의 기기 생성
	- 그리고 사용자 그룹이 이미 있는 테이블을 선택해서 공간에 연결만 하면 끝~

- **웹사이트 로그인은 세션 만료되면 귀찮고, 기숙사 사용자라면 이미 인증된 계정이 있을 수도 있으니, 그걸 활용하면 좋지 않을까?**
	- -> PWA + React에선 localStorage나 IndexedDB에 토큰 저장해서 자동 로그인 가능
		- 주의할점!
			- Localstorage는 - JavaScript로 접근 가능하기 때문에, 사이트에 악성 스크립트가 삽입되면 탈취 가능
			- 토큰을 너무 오래 유지하지 않고, **Refresh Token 전략 사용**
			    
			- XSS 방지를 위한 CSP(Content Security Policy) 설정
-  별도의 회원가입 불편
	- 기숙사측에 api를 요청하거나, 외부페이지 이동은 기숙사측 홈페이지가 없거나, 서버가 불안정할때 사용불가능해
	- 기숙사 측에서 제공한 정보를 바탕으로 자동으로 아이디 비번을 생성하고, 로그인시 비밀번호를 변경하게 유도
- 최소한의 개인정보
	- 민감한 개인정보 최소화
		- 전화번호-> 따로 연락해야할 사항이있을때 식별이름만 알려주고 자체 소통공간에서 해결하게
		- 성별-> 남녀공용같은 경우는 그냥 관리자가 성별없이 동,층,호실별로 부여하게 하면 성별필터를 거칠 필요가 없음.

- 아이디 비밀번호 자동생성 형식
- 예약시스템 구현

네트워크 설계는 새로 탭을 생성함

<5/11>흐름
- 자리 하나가 있어서 세탁하러갔는데 가는도중에서 누가 사용중으로 전환했다면? 헛수고 10분전에 사용등록하게 하고, qr이나 nfc태그로 사용인증
	- 예약까지 넣으면 빨래 하나하는데 경험이 복잡해지지 않을까
	- 사용등록을 출발하기전에 하는 시스템으로 하자 이때 10분까지 대기시간을 정할수있도록
		-  누가 악용해서 예약하고 늦게 가지 않을까
			- 그거는 특정 구분이 가능하므로 신고가능하게하자
		- 예약없이 갔고 모든 준비 다끝냈는데 갑자기 다른사람이 예약이 되어버린다면?
			- 예약희망일뿐 예약은 아닌걸로 락은 걸지 말자. 다른사람이 할수있게.
		- 그럼...도착한다음에 하려던 사람은 ㄹㅇ 헛수고..? qr스캔 헛수고
	- 기기가 한대 남으면 출발했어요라는 기능을 넣고 기기가 예약되고 제한시간안에 도착 안하면 풀리고 경고 먹는 그런..?
		- 근데 가다가ㅏ 변수가 생겨서~ 늦게 도착했다거나..?
- 채팅기능을 넣을까(->같은기기를 공유하는 사람들끼리 소통이 필요할까? 이미 소통관련 톡이 개설된경우 불필요하고 귀찮음 )
	-  아예 채팅앱으로 전환?
	- 대신 설계된 말풍선만 골라서 대화하게
		- (자신의 식별번호) (기기식별번호)사용신청합니다 예상 소요시간은(사용시간)입니다 
- 사용자가 **사용 시간을 90분, 120분 등으로 길게 설정**해버리고, 실제로는 **늦게 도착하거나 아예 사용하지 않는 경우**가 발생할 수 있다 ,사용자가 출발하지 않고도 **먼 거리에서 사용등록을 완료**해버리면, 세탁실에 도착하지 않은 상태에서 이미 기기 사용이 예약되므로, **다른 사용자는 해당 기기를 사용할 수 없게 되는 구조적인 문제**
	- 사용 등록 시, **최대 사용 시간 제한**을 설정한다.
	- 도착을 확인시켜야한다
		- **NFC 태그 또는 QR 코드 스캔을 통해 도착을 확인**하게 한다.
			- 스캔이 안되는 경우?
			- qr코드의 문제
				- qr사진찍어두고 그거 스캔하면 바로 접속가능
				- qr코드는 패스하자
		- W3C 위치 정보 API(Geolocation API) 
- 연장은 **기기 앞에서 NFC 태그 또는 QR 코드로만 허용**.


- 5/11 정리(앱전환시 고려하기로.)
	- 해당기기를 스캔을 해야 사용등록이 가능하다.
	- 출발해요 시스템: 10분동안 그 기기를 예약희망한다고 표시할수있다
		- 출발해요는 **40분 내 한번에 사용가능한 기기의 수만큼 허용**.
		- 그러나 다른사람들의 예약이 막히는건 아니고
		- 먼저 도착해 스캔한 사람이 있다면 출발해요 표시는 풀리고 도착했어요 표시가 생기고, 누군가 먼저 왔다고 알린다.
		- 즉  여러 사용자가 동시에 출발해요 요청을 보낼 경우, **도착해요 스캔이 먼저인 사용자가 우선권**을 갖게 된다. 그리고 나머지 사용자는 “이미 도착한 사용자가 있습니다”라는 알림을 받게 된다.
	- 도착했어요 시스템: Nfc 스캔과 동시에 와이파이 강도/Gps를 검사해 인증이 되면 도착했다는 기기에 표시가 5분간 생긴다 
		- 비로소 사용등록이 가능하다(스캔이 일종의 락)
		- 한번 스캔후 5분락 걸려 누군가가 또 스캔시도하면 거절됨
		- 문제점
			- nfc태그 주기적 점검
			- nfc태그 제거, 교체시
	- 사용자 도착 인증(3단계중 2단계만 되도 통과)
		- 0단계: 비콘(공간별로 설치 필요)-> 1,2,3단계 패스
		- 1단계: nfc태그->ios에서 앱만가능
			- 사용자
				- 매번 nfc키고 스캔해야함
				- 잘못된 위치에 있으면 반복시도해야함
					- nfc리더기 민감도 조정
		- 2단계: wifi강도->Ios에서 앱만가능
			- 사용자
				- Wi-Fi 신호 강도는 **사람이 이동하거나 장애물이 있을 경우 달라질 수 있음**.
					- **3개 이상의 AP 신호를 동시에 측정**하여 평균값으로 인증
				- Wi-Fi 신호를 주기적으로 스캔해야 하므로, **배터리 소모가 커짐**
					- Wi-Fi 스캔 주기를 **5초 또는 10초로 조정**
					- AP 위치가 변경될 경우, **모든 측정 지점에서 신호 패턴을 다시 측정**해야 함.
					- AP가 **오프라인이거나 고장난 경우, 신호 강도가 누락**될 수 있음.
					- 같은 채널에서 **다른 AP 신호가 간섭을 일으킬 수 있음**.
			- 관리자 
				- AP의 위치가 **이동되거나 교체되면 신호 패턴이 변경됨**
		- 3단계: gps
			- IPGeolocation.io(무료 30,000회/월, 유료 $15/월~)
			- Geoapify(무료 플랜, 저렴한 유료 요금제)
			- 사용자
				- GPS는 **실내에서 신호를 잡는데 시간이 걸릴 수 있음**.
				- 실내에서 GPS 신호가 약하거나 **오차 범위가 30m 이상일 수 있음**.
				- GPS 추적은 **배터리 소모가 크다**.
				- GPS는 실내에서 **정확도가 떨어지므로, 스캔 시도가 반복됨**.
				- 사용자의 **위치 데이터가 서버로 전송되므로 프라이버시 이슈 발생**.
					- **AES 또는 TLS 기반 암호화 적용**
	- url 조작에 대비해
		- 암호화하기
	- 연장할때


- 5/11(결론)
	- nfc태그를 읽는건 아이폰, 안드로이드 가능하니까 NfC태그로 통한 도착인증.
		- NTAG 424 DNA 칩셋을 사용해 동적 URL을 생성
		- url 복붙으로 원격접속 방지
		- **서버 주소 자체를 변경하는 것이 아니라, URL의 파라미터 값**을 동적으로 변경이라 찐 주소 알아내도 다행
		- **서버에서 검증하는 방식:**
			1. 서버는 data와 signature를 추출:
			    
			    - data: 202305081230
			        
			    - signature: A1B2C3D4E5F6G7H8
			        
			    
			2. 서버는 **서버 측 비밀 키(Secret Key)를 사용해 동일한 방식으로 서명을 생성**:
			    
			    - expected_signature = AES-128(data + secret_key)
			        
			    
			3. 서버는 expected_signature와 signature를 비교:
			    
			    - 두 서명이 일치하면 인증 성공.
			        
			    - 서명이 일치하지 않거나 만료되었으면 인증 실패.
	- mvp로 출발해요, 도착했어요(NTAG 424 DNA 칩셋) 시스템 없이 개발후 추가하는걸로 하자
	- Nfc 안되는경우 nfc가 안돼요 클릭한다
		- gps로 위치 확인 후 서버에서 사용자에게 일회성 링크 발급하고 기록 남김
		- 그리고 관리자에게 nfc안된다고 전송


5/14
- 기숙사측 주도형, 학생 주도형으로 두가지 나누어서 도입이 가능하게 ?
	- 학생이 만든 기관이 운영 미흡하거나, 관리 없이 방치되면 **시스템 전체 품질 저하**
	- - 공식 기관인지, 테스트 기관인지 사용자 입장에서 **구분이 되지 않으면 혼란**
- 공간은 계층으로 구분하지않고 현재는 공간 이름만으로 충분할것같아 지금은 평면 구조로 시작하되,  그래도 전환이 쉽게 DB 스키마만 미리 parent_location_id 필드로 준비하자
- 아예 기숙사 측에서 정보들을 넘겨받지 말고  로그인없이 즉시 예약만가능하게..?
- >  “**호실(방) 단위 권한이 정말 필요한가?**”
	- **본 권한 단위를 ‘호실 단위’로 고정하는 건 피하는 게 좋다.”**
	- 대신, **기본은 ‘층’ 또는 ‘공용 그룹 단위’로 운영하고**, ✅ **호실 단위는 ‘예외 상황에만 수동 처리’ 구조로 남겨두는 게 이상적이야.**
- 전체 기관에게 통용될려면 동, 층, 호실 까지 분류하는게 좋은데사용자 그룹은 보통 하나의 기준으로 통용된단 말이지?


좋아, 지금까지 너가 고민했던 내용을 **의사결정 흐름에 따라 핵심 키워드별로 정리**해줄게.

이건 설계 명세서나 발표용 문서에도 바로 활용 가능해.

---

# **✅ 너의 핵심 고민 정리**

---

## **1.** 

## **사용자 권한 부여 방식**

  

### **❓ 고민:**

- “사용자에게 권한을 줄 때, 호실(302호 등) 단위로 줘야 할까?”
    
- “아니면 층(3층 전체) 단위로 줘야 할까?”
    

  

### **✅ 결론:**

- **기본은 층 단위 그룹(FLOOR)로 권한 부여**
    
- **호실 단위(ROOM)는 예외적 상황에만 수동 생성**
    
- **관리 효율성과 그룹 수 최소화를 위해 층 기준을 우선함**
    

---

## **2.** 

## **기관마다 권한 기준이 다를 수 있음**

  

### **❓ 고민:**

- “어떤 기숙사는 층 기준, 어떤 곳은 호실 기준으로 권한을 줄 수도 있는데, 이걸 어떻게 통일하지?”
    

  

### **✅ 결론:**

- 기관마다 group_assignment_policy를 설정하여 유연하게 대응
    
    - BY_FLOOR, BY_ROOM, CUSTOM 방식 지원
        
    
- 사용자 등록 시 해당 기관의 정책을 기준으로 **자동 그룹 매핑**
    

---

## **3.** 

## **그룹 구조와 공간 구조의 연결**

  

### **❓ 고민:**

- “사용자는 그룹 하나에만 속하게 하되, 그룹이 어떻게 공간과 연결돼야 하지?”
    

  

### **✅ 결론:**

- groups ↔ locations 구조를 유지 (location_access 테이블 활용)
    
- 예외적으로 개별 사용자 ↔ 공간 연결이 필요한 경우:
    
    - user_location_exceptions 테이블로 처리
        
    - 기간 제한 가능 (expires_at 포함)
        
    

---

## **4.** 

## **기숙사 시스템과의 연동 범위**

  

### **❓ 고민:**

- “기숙사 시스템에서 정규화된 테이블(Student, CommonSpace 등)을 이미 운영하고 있는데, 내 시스템과 완전 통합해야 할까?”
    

  

### **✅ 결론:**

- **Read-Only 연동 전략 채택**
    
    - Student, CommonSpace, AccessPermission 등의 테이블에서 필요한 데이터만 **일부 추출**
        
    - 너의 시스템은 독립적으로 동작하면서 연동된 데이터로 사용자/공간 초기화
        
    

---

## **5.** 

## **그룹 자동 생성 및 사용자 자동 배치**

  

### **❓ 고민:**

- “사용자 등록할 때, 그룹을 어떻게 자동으로 나누고 배치할까?”
    

  

### **✅ 결론:**

- 기숙사에서 추출한 필드(room_code, floor_number, 등)를 기준으로 자동 그룹 생성
    
- 이 필드를 grouping_key로 기록하여 추적 및 재매핑 가능
    
- 사용자 테이블에는 last_grouping_value 필드를 두어 변경 여부 판단 가능
    

---

## **6.** 

## **유지보수와 확장성**

  

### **❓ 고민:**

- “방 이동, 퇴사 등 상황에서 그룹 재배정은 어떻게 하지?”
    
- “이후 예외 사용자 처리도 가능한가?”
    

  

### **✅ 결론:**

- 정기 동기화 프로세스를 설계하여 사용자 정보 변경 감지 → 자동 그룹 재배정
    
- user_location_exceptions로 예외 권한 처리 가능
    
- 추가적으로 group_assignment_logs로 변경 이력 추적 가능
    

---

## **✅ 요약 키워드**

|**주제**|**결론**|
|---|---|
|권한 부여 기준|기본은 층 단위, 호실은 예외|
|그룹 구조|사용자 ↔ 그룹, 그룹 ↔ 공간|
|연동 방식|Read-Only 연동, CSV/API 대응|
|자동화 기준|grouping_field 기반 자동 생성|
|예외 처리|user_location_exceptions 테이블|
|확장 대응|기관별 정책 설정 + 동기화 설계|
|데이터 무결성|UNIQUE 키, 외래키, 정규화 유지|
