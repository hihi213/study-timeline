

## **WebSocket + PWA ì›¹í‘¸ì‹œ vs FCM í‘¸ì‹œ ì•Œë¦¼ vs PWA ë‚´ë¶€ ì•Œë¦¼(ì„œë¹„ìŠ¤ ì›Œì»¤) ì°¨ì´ì **

- pwa: ì•±ì˜ êµ¬ì¡°ì¼ë¿ ì•Œ
- ì„œë¹„ìŠ¤ì›Œì»¤: pwa ë¸Œë¼ìš°ì €ê°€ êº¼ì ¸ìˆì–´ë„ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì•Œë¦¼ì„ í‘œì‹œë§Œ í•´ì£¼ëŠ” ì—”ì§„(ì „ì†¡, ìˆ˜ì‹ x)
	- ë¸Œë¼ìš°ì €ë‘ ë³„ë„ë¡œ ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œì—ì„œ ë™ì‘
- ì•Œë¦¼ì„ ì „ì†¡í•˜ëŠ” êµ¬ì¡°
	- ì—°ê²°ëœê²½ìš°
		- webSocket: ë¸Œë¼ìš°ì €ê°€ ë‹«í˜€ìˆì§€ ì•Šê³  ì—´ë ¤ìˆì„ë•Œ ë°ì´í„° ì „ì†¡, ìˆ˜ì‹ 
			- Â ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ë™ì‹œì— ì˜ˆì•½ ê°€ëŠ¥í•œ ì‹œê°„ëŒ€ë¥¼ ë³´ê³  ìˆê³ , ëˆ„êµ°ê°€ ì˜ˆì•½ì„ ì™„ë£Œí–ˆì„ ë•ŒÂ **ë‹¤ë¥¸ ì‚¬ìš©ì í™”ë©´ì— ì¦‰ì‹œ ë°˜ì˜**í•´ì•¼ í•œë‹¤ë©´ ì›¹ì†Œì¼“ì„ ì‚¬ìš©
			- ë‹¨ìˆœ ì˜ˆì•½ ì²˜ë¦¬(ì˜ˆì•½ ìƒì„±/ì·¨ì†Œ)ëŠ” REST APIë¡œë„ ì¶©ë¶„í•˜ì§€ë§Œ,   **ì˜ˆì•½ ìƒíƒœë¥¼ ì—¬ëŸ¬ ì‚¬ìš©ìì—ê²Œ ì‹¤ì‹œê°„ìœ¼ë¡œ ë™ê¸°í™”**í•˜ë ¤ë©´ WebSocketì´ í‘œì¤€ì  ì„ íƒ
	- ë°±ê·¸ë¼ìš´ë“œì—ë„ ê°€ëŠ¥
		- FCMëŠ” ì•±ì´ ì—´ë ¤ìˆë“ , ë°±ê·¸ë¼ìš´ë“œì— ìˆë“  ì„œë¹„ìŠ¤ì›Œì»¤ë¥¼ í†µí•´ ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œ ì•Œë¦¼ì„ ë³´ë‚´ì£¼ëŠ” ì„œë¹„ìŠ¤ì´ë‹¤ ì•„ì´í°ì—ì„œëŠ” FMC ëª»ì“°ê³  apns ì¨ì•¼í•´ì„œ ìœ ë£Œ
		- **APNs** (ìœ ë£Œ)
		- **Web Push (VAPID)** (ë¬´ë£Œ)
			- ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œ ì¼ë°©ì , ë¹„ë™ê¸°ì  ì•Œë¦¼ì „ì†¡


# ì•Œë¦¼ê³„íš
- ì ‘ì†ì¤‘: websocket
	- ì ‘ì†í• ë•Œ(websocket)
		- ì‚¬ìš©ë“±ë¡ì‹œì‘ ì•Œë¦¼
		- ê´€ë¦¬ìì˜ ê³µì§€(ê¸°ê¸° ìˆ˜ë¦¬ì™„ë£Œ/ã…‡ã…‡ê¸°ê¸° ê³ ì¥ê³µì§€/ìˆ˜ë¦¬ê³µì§€ ë“± ì‹¤ì‹œê°„ìœ¼ë¡œ ì‚¬ìš©í•  ê¸°ê¸°ì™€ ê´€ë ¨í•˜ì—¬)
		- ì ‘ì†í• ë•Œ ê³ ë¯¼ ì–´ë–¤ë°©ì‹ì„ í• ê¹Œ?
			- rest Api
				- í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­ì„ ë³´ë‚¼ ë•Œë§ˆë‹¤ ì„œë²„ì™€ ìƒˆë¡­ê²Œ ì—°ê²°í•˜ê³ , ì‘ë‹µ í›„ ì—°ê²°ì´ ì¢…ë£Œë©ë‹ˆë‹¤.  ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ìƒíƒœë¥¼ ê¸°ì–µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
			- Websocket
				- í•œ ë²ˆ ì—°ê²°ì´ ì„±ë¦½ë˜ë©´ í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ê°€ ê³„ì† ì—°ê²°ëœ ìƒíƒœë¥¼ ìœ ì§€í•˜ë©°, ì±„ë„ì´ ë‹«í ë•Œê¹Œì§€ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤
			- Â **SSE (Server-Sent Events)**
				- ì„œë²„ì—ì„œ ì¼ë°©ì ìœ¼ë¡œ í‘¸ì‹œ
				-  ì˜ˆì•½ ìš”ì²­, ì˜ˆì•½ ì·¨ì†Œ ë“±ì˜ **ì–‘ë°©í–¥ í†µì‹ ì´ í•„ìš”í•œ ìƒí™©ì—ì„œ ë¶€ì í•©**
			- Http polling
				-  **ì¦‰ê°ì ì¸ ì•Œë¦¼ ì „ë‹¬ì´ í•„ìš”**í•˜ë¯€ë¡œ,
				- Pollingì€ ì‹¤ì‹œê°„ì„± ì¸¡ë©´ì—ì„œ ë¹„íš¨ìœ¨ì ì„.
				- ì‚¬ìš©ììˆ˜ëŠ˜ì–´ë‚˜ë©´ ì„œë²„ ë¦¬ì†ŒìŠ¤ ê¸‰ì¦
			- **. Long Polling**
				- Long Pollingì€ ì‹¤ì‹œê°„ í†µì‹ ì„ ëª¨ë°©í•  ìˆ˜ëŠ” ìˆì§€ë§Œ,
				- ì˜ˆì•½ ì‹œìŠ¤í…œì²˜ëŸ¼ **ì¦‰ê°ì ì¸ ì•Œë¦¼ ì „ë‹¬ì´ í•„ìˆ˜ì ì¸ ìƒí™©**ì—ì„œëŠ”
				- WebSocketì— ë¹„í•´ íŠ¸ë˜í”½ ì†Œëª¨ì™€ ì‘ë‹µ ì§€ì—°ì´ ë” í¼.
			- ì–‘ë°©í–¥ í†µì‹ , ì‹¤ì‹œê°„ ì˜ˆì•½ ì—…ë°ì´íŠ¸, ì˜ˆì•½ ì·¨ì†Œ ì•Œë¦¼ì— ìµœì í™”ëœ ì›¹ì†Œì¼“ì‚¬ìš© ê·¸ëŸ¬ë‚˜ ë¸Œë¼ìš°ì €ê°€ ë‹«íˆë©´ ì‚¬ìš©ë¶ˆê°€ëŠ¥í•˜ë‹ˆ ë°±ê·¸ë¼ìš´ë“œë¡œ ì•ˆë“œë¡œì´ë“œFCM Ios webpushë¡œ ì¶”ê°€ êµ¬í˜„
- ì•ˆë“œë¡œì´ë“œ ë°±ê·¸ë¼ìš´ë“œ: PWA+FCM
- ì•„ì´í° ë°±ê·¸ë¼ìš´ë“œ:  PWA+ webpush
	- ì‚¬ìš© ì¢…ë£Œì„ë°•ì•Œë¦¼
	- ë‹¤ë¥¸ìœ ì €ì˜ ì„¸íƒ ìˆ˜ê±° ìš”ì²­
	- ê´€ë¦¬ìì˜ ê³µì§€(ì„œë²„ ì ê²€ì‹œê°„, ëª¨ë“  ì„¸íƒê¸°ê°€ ê³ ì¥ë‚¨ ë“±ì˜ ë¯¸ë¦¬ ì‹¤ì‹œê°„ìœ¼ë¡œ ê³µì§€í•´ì•¼í•  ì‚¬í•­ë“¤ ì‹œê°„ëŒ€ ì˜ˆì•½ë°œì†¡)
	- ì•„ì´í°ì—ì„œ
		- í™ˆí™”ë©´ì— ì¶”ê°€(PWAì„¤ì¹˜)í›„ ì•Œë¦¼ê¶Œí•œ í—ˆìš©í•´ì•¼ ì§€ì›ë¨
		- ì ê²¨ìˆê±°ë‚˜, ì ˆì „ëª¨ë“œì´ê±°ë‚˜ ì™„ì „íˆ ë‹«í˜€ìˆì–´ë„ ì›¹í‘¸ì‹œ ë³´ë‚¼ìˆ˜ìˆìŒ
		- í‘¸ì‹œ êµ¬ë… í† í°ì´ ì£¼ê¸°ì ìœ¼ë¡œ ë§Œë£Œë˜ì–´, ì‚¬ìš©ìê°€ ì¬ë“±ë¡í•´ì•¼ í•˜ëŠ” ê²½ìš°
		- iOSëŠ” **ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™”(Background Sync)**ë¥¼ ì§€ì›í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, í‘¸ì‹œ ì•Œë¦¼ ì™¸ì˜ ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…ì€ ë¶ˆê°€í•©ë‹ˆë‹¤
		- Silent Push(ë¬´ìŒ ì•Œë¦¼)ì€ ì§€ì›í•˜ì§€ ì•Šì•„, ëª¨ë“  ì•Œë¦¼ì´ ë°˜ë“œì‹œ ì‚¬ìš©ìì—ê²Œ í‘œì‹œë©ë‹ˆë‹¤
			- ê´€ë¦¬ìê°€ ê³µì§€í• ë•Œ ì†Œë¦¬ë‚˜ê²Œ ì„¤ì •í• ì§€,ì‹œê°„ëŒ€ê³ ë ¤í•´ì„œ ì „ì†¡í• ìˆ˜ìˆë„ë¡
	- ì•ˆë“œë¡œì´ë“œ
		- ì ˆì „ëª¨ë“œì¼ì‹œ: ì „ë‹¬ ì•ˆë ìˆ˜ìˆìŒ
			- ë°˜ë©´ FCMì´ë©´ high priorityì„¤ì •í•˜ë©´ ì „ë‹¬ê°€ëŠ¥
- ê³ ë¯¼í•´ê²°:  ì˜ˆì•½ì€ ì‹¤ì‹œê°„ ì˜ˆì•½ì´ ì•„ë‹ˆë¼, **ì‚¬ìš©ìê°€ ë¬¼í’ˆì„ ì‚¬ìš©í•˜ê¸° ì‹œì‘í•  ë•Œ â€œì‚¬ìš© ì¤‘â€ìœ¼ë¡œ ë“±ë¡í•˜ëŠ” êµ¬ì¡°**ë¼ ì¦‰ê°ì ì¸ ë™ê¸°í™”ëŠ” í•„ìš”ì¹˜ ì•ŠìŒ
	- long polling sse websocketì€ ê³¼ë„í•œê²Œ ì•„ë‹Œê°€..
	- ì›¹ì†Œì¼“ì„ ì ‘ì†ì¤‘ì—ì„œë§Œì´ë¼ë„ ì‚¬ìš©í•˜ëŠ”ì´ìœ 
		- ê³¼ë„í•œ ì„œë²„ë¶€í•˜ ë¶ˆí•„ìš”í•œ íŠ¸ë˜í”½ë°œìƒ ì‹¤ì‹œê°„ì„± ì €í•˜


- **ì ‘ì† ì‹œ:** WebSocket ì—°ê²° ì‹œë„
    - ì—°ê²° ì„±ê³µ ì‹œ, ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì‹œì‘ (WebSocket.onmessage í™œìš©)
- **ì ‘ì† ì¤‘:**
    - WebSocket ì—°ê²°ì´ ìœ ì§€ë˜ëŠ” í•œ, ì˜ˆì•½ ìƒíƒœê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ **ì¦‰ì‹œ ì „ì†¡**
- **ë°±ê·¸ë¼ìš´ë“œ ì „í™˜:**
    - WebSocketì´ ëŠì–´ì§€ë©´,
    - ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ ìƒíƒœë¥¼ DISCONNECTEDë¡œ ì „í™˜í•˜ê³ ,
    - ì˜ˆì•½ ìƒíƒœ ë³€ê²½ ì‹œ FCM/WebPushë¡œ ì•Œë¦¼ ì „ì†¡.
- **ì¬ì ‘ì† ì‹œ:**
    - WebSocket ì¬ì—°ê²° ì‹œì‘
    - ì¬ì—°ê²° ì‹œ **ê°™ì€ ì‚¬ìš©ìë¡œ ì‹ë³„í•˜ëŠ” ê²ƒì´ ë§¤ìš° ì¤‘ìš”**í•˜ë‹¤.	
	1. WebSocket ì—°ê²° ì‹œ, **ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ userIdë¥¼ ì „ì†¡**í•˜ê±°ë‚˜,
	    
	2. WebSocket ì—°ê²° ì§í›„ ì²« ë©”ì‹œì§€ë¡œ **IDENTIFY ë©”ì‹œì§€**ë¥¼ ì „ì†¡í•˜ì—¬ ì‚¬ìš©ì ì‹ë³„.
	3. **ë°±ê·¸ë¼ìš´ë“œ ì „í™˜:**
	    
	    - WebSocketì´ ëŠì–´ì§€ë©´, ì„œë²„ëŠ” í•´ë‹¹ ì‚¬ìš©ìì˜ userIdë¥¼ **DISCONNECTEDë¡œ ì „í™˜**.
	        
	    
	4. **ì¬ì ‘ì† ì‹œ:**
	    
	    - ë™ì¼í•œ userIdë¡œ ì¬ì—°ê²° ì‹œ, ì„œë²„ëŠ” **ì´ì „ ìƒíƒœë¥¼ ê·¸ëŒ€ë¡œ ë³µì›**í•˜ê³ ,
	        
	    - í´ë¼ì´ì–¸íŠ¸ì—ê²Œ **ë³€ê²½ëœ ì˜ˆì•½ ìƒíƒœë¥¼ ì¦‰ì‹œ ì „ì†¡**.

- WebSocketì´ ì—°ê²°ëœ ìƒíƒœ:
    - ì‹¤ì‹œê°„ìœ¼ë¡œ ì˜ˆì•½ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸ (ì¶œë°œí•´ìš” â†’ ë„ì°©í•´ìš” â†’ ì‚¬ìš© ë“±ë¡ íë¦„)
- ê·¸ì „ ê³ ë¯¼ë“¤
	- WebSocketì´ ëŠì–´ì§„ ìƒíƒœ(ì›¹í˜ì´ì§€ë¥¼ ë²—ì–´ë‚˜ ë‹¤ë¥¸ ì•±ì„ íŠ¼ë‹¤):
	    - ì„œë²„ëŠ” **FCM/WebPushë¡œ ë‹¨ì¼ ì•Œë¦¼ ì „ì†¡** (ì˜ˆì•½ ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŒì„ ì•Œë¦¼)
	    - WebSocketì„ ëŠê³  Pollingì„ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì€ **ì„œë²„ ë¦¬ì†ŒìŠ¤ ì†Œëª¨ì™€ ë°ì´í„° ì†Œëª¨ê°€ í¬ë‹¤.**
			- Exponential Backoff + Heartbeatë¥¼ ì¡°í•©í•´ ì•ˆì •ì ì¸ ì—°ê²°ì„ ìœ ì§€í•˜ê³ ,WebPush/FCMìœ¼ë¡œ ë°±ê·¸ë¼ìš´ë“œ ì•Œë¦¼ì„ ì²˜ë¦¬í•˜ì
			- WebSocket + HTTP GET ì¡°í•©
				- ì¬ì ‘ì† ì‹œ HTTP GETìœ¼ë¡œ ì¦‰ì‹œ ë™ê¸°í™” â†’ ì‚¬ìš©ìê°€ ìµœì‹  ìƒíƒœë¥¼ ë°”ë¡œ í™•ì¸.
				â€¢	WebSocketìœ¼ë¡œ ì§€ì†ì  ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ â†’ ì¶”ê°€ ë³€ë™ ì‚¬í•­ ì¦‰ì‹œ ë°˜ì˜.

## WebSocket ì¬ì—°ê²° ì‹œ ì„¸ì…˜ ìœ ì§€ ë°©ë²•

WebSocket ì—°ê²°ì´ ëŠê²¼ë‹¤ê°€ ì¬ì—°ê²°ë˜ë©´ **ì„œë²„ê°€ ìƒˆë¡œìš´ ì„¸ì…˜ìœ¼ë¡œ ì¸ì‹**í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì•„ë˜ ë°©ë²•ì„ í†µí•´ **ì„¸ì…˜ì„ ìœ ì§€**í•˜ê³  **ì¬ì—°ê²°ì˜ ì˜ë¯¸ë¥¼ ë¶€ì—¬**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### **1. ì„¸ì…˜ ì‹ë³„ì(Session ID) í™œìš©**
#### **(1) ì¸ì¦ í† í° ì „ë‹¬**
- **JWT/ì¿ í‚¤ ê¸°ë°˜ ì¸ì¦**:  
  - í´ë¼ì´ì–¸íŠ¸ê°€ ìµœì´ˆ ì—°ê²° ì‹œ ì¸ì¦ í† í°(JWT) ë˜ëŠ” ì¿ í‚¤ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.  
  - ì„œë²„ëŠ” í† í°ì„ ê²€ì¦í•´ ì‚¬ìš©ì ì„¸ì…˜ì„ ì‹ë³„í•˜ê³  ìƒíƒœë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.  
  ```javascript
  // WebSocket ì—°ê²° ì‹œ í† í° ì „ë‹¬ ì˜ˆì‹œ (í´ë¼ì´ì–¸íŠ¸)
  const ws = new WebSocket('wss://example.com/ws?token=eyJhbGci...');
  ```

#### **(2) ì„¸ì…˜ ID ë°œê¸‰ ë° ê´€ë¦¬**
- ì„œë²„ê°€ ìµœì´ˆ ì—°ê²° ì‹œ ê³ ìœ í•œ `session_id`ë¥¼ ë°œê¸‰í•˜ê³ , í´ë¼ì´ì–¸íŠ¸ëŠ” ì¬ì—°ê²° ì‹œ ì´ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.  
  ```javascript
  // ì„œë²„ ì¸¡ ì„¸ì…˜ ë§¤í•‘ ì˜ˆì‹œ (Node.js)
  const sessions = new Map();

  ws.on('connection', (client, req) => {
    const sessionId = req.headers['session-id'] || generateNewSessionId();
    sessions.set(sessionId, client);
  });
  ```

---

### **2. WebSocket ì„¸ì…˜ ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜**
#### **(1) RingCentral ë°©ì‹: `wsc` í† í° í™œìš©** [ê²€ìƒ‰ ê²°ê³¼ 2]
- **ì ˆì°¨**:  
  1. ìµœì´ˆ ì—°ê²° ì‹œ ì„œë²„ëŠ” `wsc`(WebSocket Connection Token)ë¥¼ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬.  
2. ì¬ì—°ê²° ì‹œ í´ë¼ì´ì–¸íŠ¸ëŠ” `wsc`ë¥¼ ì„œë²„ì— ì „ì†¡ â†’ ì„œë²„ê°€ ê¸°ì¡´ ì„¸ì…˜ ë³µêµ¬.  
``` http
  wss://example.com/ws?access_token=XXX&wsc=YYY
```
- **ë³µêµ¬ ì„±ê³µ ì‹œ**:  
  - ëˆ„ë½ëœ ì´ë²¤íŠ¸ ì „ì†¡ (ë³µêµ¬ ë²„í¼ í¬ê¸° ë‚´ì—ì„œ).  
  - ê¸°ì¡´ êµ¬ë… ìœ ì§€.  

#### **(2) Moveo.AI ë°©ì‹: `session_id` ë™ê¸°í™”** [ê²€ìƒ‰ ê²°ê³¼ 3]
- í´ë¼ì´ì–¸íŠ¸ê°€ `session_id`ë¥¼ ì €ì¥í•˜ê³  ì¬ì—°ê²° ì‹œ ì „ì†¡í•©ë‹ˆë‹¤.  
  ```javascript
  // í´ë¼ì´ì–¸íŠ¸ ì˜ˆì‹œ
  let savedSessionId = localStorage.getItem('session_id');

  function reconnect() {
    const ws = new WebSocket(`wss://example.com/ws?session_id=${savedSessionId}`);
  }
  ```

---

### **3. ì™¸ë¶€ ì„¸ì…˜ ì €ì¥ì†Œ í™œìš© (Redis ë“±)** [ê²€ìƒ‰ ê²°ê³¼ 4,5]
#### **(1) Redisì— ì„¸ì…˜ ë°ì´í„° ì €ì¥**
- **ì¥ì **:  
  - ì—¬ëŸ¬ WebSocket ì„œë²„ê°€ ì„¸ì…˜ ë°ì´í„°ë¥¼ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
  - ë¡œë“œ ë°¸ëŸ°ì‹± í™˜ê²½ì—ì„œë„ ì„¸ì…˜ ìœ ì§€ ê°€ëŠ¥.  
- **ì˜ˆì‹œ**:  
  ```javascript
  // Socket.IO + Redis ì–´ëŒ‘í„°
  const io = require('socket.io')(server);
  const redisAdapter = require('socket.io-redis');
  io.adapter(redisAdapter({ host: 'localhost', port: 6379 }));
  ```

#### **(2) Sticky Session (ì„¸ì…˜ ê³ ì •)** [ê²€ìƒ‰ ê²°ê³¼ 5]
- ë¡œë“œ ë°¸ëŸ°ì„œê°€ í´ë¼ì´ì–¸íŠ¸ IP/ì¿ í‚¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë™ì¼í•œ ì„œë²„ë¡œ ë¼ìš°íŒ…í•©ë‹ˆë‹¤.  
- **ì¥ì **: ì„œë²„ ë‚´ ë©”ëª¨ë¦¬ì—ì„œ ì„¸ì…˜ì„ ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
- **ë‹¨ì **: ì„œë²„ ë‹¤ìš´ ì‹œ ì„¸ì…˜ ì†ì‹¤ ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤.  

---

### **4. ì¬ì—°ê²° ì‹œë‚˜ë¦¬ì˜¤ë³„ ì²˜ë¦¬**
| ìƒí™©                  | í•´ê²° ë°©ë²•                                      | ë¹„ê³                           |
|-----------------------|-----------------------------------------------|-------------------------------|
| **ì¼ì‹œì  ë„¤íŠ¸ì›Œí¬ ëŠê¹€** | Exponential Backoff + ì„¸ì…˜ ID ì „ì†¡            | 1ì´ˆ â†’ 2ì´ˆ â†’ 4ì´ˆ ì¬ì‹œë„         |
| **ì„œë²„ ì¬ì‹œì‘**        | Redisì— ì„¸ì…˜ ë°±ì—… + `session_id` ë³µêµ¬         | ì„œë²„ ì¥ì•  ëŒ€ë¹„                 |
| **ë‹¤ë¥¸ ì„œë²„ë¡œ ì—°ê²°**    | ë¡œë“œ ë°¸ëŸ°ì‹± + Sticky Session/Redis ì„¸ì…˜ ê³µìœ   | ìˆ˜í‰ í™•ì¥ í™˜ê²½ í•„ìˆ˜            |

---

### **5. ê²°ë¡ : ì¬ì—°ê²°ì´ ì˜ë¯¸ ìˆê²Œ ë§Œë“œëŠ” ë°©ë²•**
1. **ì„¸ì…˜ ì‹ë³„ì ì „ë‹¬**: JWT, `session_id`, `wsc` í† í° ë“±ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‹ë³„í•©ë‹ˆë‹¤.  
2. **ìƒíƒœ ì™¸ë¶€ ì €ì¥**: Redis ë“±ì— ì„¸ì…˜ ë°ì´í„°ë¥¼ ì €ì¥í•´ ì„œë²„ ê°„ ê³µìœ í•©ë‹ˆë‹¤.  
3. **Exponential Backoff**: ê³¼ë„í•œ ì¬ì‹œë„ë¥¼ ë°©ì§€í•˜ë©´ì„œ ì—°ê²°ì„ ë³µêµ¬í•©ë‹ˆë‹¤.  
4. **WebPush/FCM**: ì—°ê²° ë³µêµ¬ ì‹¤íŒ¨ ì‹œ ë°±ê·¸ë¼ìš´ë“œ ì•Œë¦¼ìœ¼ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.  

> **ìš”ì•½**:  
> WebSocket ì¬ì—°ê²°ì´ ì˜ë¯¸ ìˆìœ¼ë ¤ë©´ **ì„¸ì…˜ ìœ ì§€ ë©”ì»¤ë‹ˆì¦˜**ì´ ë°˜ë“œì‹œ í•„ìš”í•©ë‹ˆë‹¤.  
> í† í° ê¸°ë°˜ ì¸ì¦, ì™¸ë¶€ ì €ì¥ì†Œ, ë¡œë“œ ë°¸ëŸ°ì‹± ì „ëµì„ ê²°í•©í•´ **ëŠê¹€ ì—†ëŠ” ì‚¬ìš©ì ê²½í—˜**ì„ ì œê³µí•˜ì„¸ìš”.



# êµ¬í˜„ê³„íš

**Service Worker íŒŒì¼ ìƒì„± â†’ VAPID Key ìƒì„± â†’ Subscription Endpoint ì €ì¥ â†’ ì•Œë¦¼ ì „ì†¡ â†’ í´ë¦­ ì‹œ ì•± ì—´ê¸°**ì˜ ìˆœì„œë¡œ êµ¬ì„±

https://www.youtube.com/watch?v=JVMiTexyp6U

### **âœ…**Â 

### **ì˜ìƒ ë‚´ìš© ìš”ì•½ ë° í•´ì„**

  

### **ì˜ìƒ ê°œìš”**

  

ì´ ì˜ìƒì€ **PWA(Public Web Application)ì— ì›¹ í‘¸ì‹œ ì•Œë¦¼(Web Push Notification)ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•**ì„ ë‹¨ê³„ë³„ë¡œ ì„¤ëª…í•˜ëŠ” ë‚´ìš©ì…ë‹ˆë‹¤. ì™¼ìª½ì€ Chromeì—ì„œ ì‹¤í–‰ë˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì´ê³ , ì˜¤ë¥¸ìª½ì€ iOS ê¸°ê¸°ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì…ë‹ˆë‹¤.

ì‚¬ìš©ìëŠ” PWAì—ì„œ ì•Œë¦¼ì„ ìŠ¹ì¸í•˜ê±°ë‚˜ ê±°ë¶€í•  ìˆ˜ ìˆìœ¼ë©°, ì•Œë¦¼ì„ í´ë¦­í•˜ë©´ ì•±ì´ ì—´ë¦½ë‹ˆë‹¤.

---

### **1. í‘¸ì‹œ ì•Œë¦¼ ì˜ˆì œ ë™ì‘ ì‹œì—°**

- Chromeì—ì„œ **ìŠ¹ì¸(Approve)** ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ í‘¸ì‹œ ì•Œë¦¼ì´ iOS ê¸°ê¸°ë¡œ ì „ì†¡ë¨.
    
- iOS ê¸°ê¸°ì—ì„œ í‘¸ì‹œ ì•Œë¦¼ì„ í´ë¦­í•˜ë©´ ì•±ì´ ì—´ë¦¬ë©°, ì´ëŠ” **ë„¤ì´í‹°ë¸Œ ì•±ì²˜ëŸ¼ ë™ì‘**í•¨.
    
- ë°˜ëŒ€ë¡œ iOS ê¸°ê¸°ì—ì„œ ìŠ¹ì¸ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ í‘¸ì‹œ ì•Œë¦¼ì´ Chromeìœ¼ë¡œ ì „ì†¡ë¨.
    

  

**ì ìš© ì‚¬ë¡€:**

- ì±„íŒ… ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ **ë©”ì‹œì§€ ìˆ˜ì‹  ì‹œ ì•Œë¦¼**ì„ ë³´ë‚´ëŠ” ë° ìœ ìš©í•¨.
    

---

### **2. ì›¹ í‘¸ì‹œ ì•Œë¦¼ êµ¬í˜„ ê°œìš”**

- **1ë‹¨ê³„:** Service Worker ë“±ë¡
    
    - Service WorkerëŠ” ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ë˜ë©°, ì•±ê³¼ëŠ” ë³„ë„ì˜ ìŠ¤ë ˆë“œì—ì„œ ë™ì‘í•¨.
        
    - í‘¸ì‹œ ì•Œë¦¼, ì˜¤í”„ë¼ì¸ ìºì‹± ë“±ì˜ ê¸°ëŠ¥ì„ ì œê³µí•¨.
        
    - ì•±ì˜ ìˆ˜ëª…ê³¼ ë¬´ê´€í•˜ê²Œ ë™ì‘í•˜ë¯€ë¡œ, ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì•Œë¦¼ì„ ì „ì†¡í•  ìˆ˜ ìˆìŒ.
        
    

  

**êµ¬í˜„ ê³¼ì •:**

- ì•± ë‚´ì—ì„œ Service Workerë¥¼ ë“±ë¡í•¨.
    
- ë“±ë¡ì´ ì™„ë£Œë˜ë©´ **Subscription Endpoint**ê°€ ìƒì„±ë¨.
    
    - ì´ EndpointëŠ” ë¸Œë¼ìš°ì €ë§ˆë‹¤ ë‹¤ë¦„.
        
    - ì´ Endpointë¥¼ ì‚¬ìš©ì í…Œì´ë¸”ì— ì €ì¥í•˜ì—¬, ë‚˜ì¤‘ì— ì´ Endpointë¥¼ í†µí•´ í‘¸ì‹œ ì•Œë¦¼ì„ ì „ì†¡í•  ìˆ˜ ìˆìŒ.
        
    

---

### **3. ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ í™•ì¸**

- Service Workerê°€ ì œëŒ€ë¡œ ë“±ë¡ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ë°©ë²•:
    
    - Chrome: Application > Service Worker íƒ­ì—ì„œ í™•ì¸ ê°€ëŠ¥.
        
    

---

### **4. PWAë¡œ ë³€í™˜**

- ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ **Next.js**ë¡œ ê°œë°œë¨.
    
- Next-pwaë¼ëŠ” íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ PWAë¡œ ë³€í™˜.
    
    - next-pwaì—ì„œ destinationì„ public í´ë”ë¡œ ì„¤ì •í•˜ê³ , register ì˜µì…˜ì„ trueë¡œ ì§€ì •í•¨.
        
    

---

### **5. ì•Œë¦¼ ìš”ì²­ ì»´í¬ë„ŒíŠ¸ êµ¬í˜„**

- NotificationRequest ì»´í¬ë„ŒíŠ¸ ìƒì„±
    
    - ë‘ ê°€ì§€ ìƒíƒœ: **Bell Off(ì•Œë¦¼ êº¼ì§)**, **Bell Ring(ì•Œë¦¼ ì¼œì§)**
        
    - ì‚¬ìš©ìê°€ Bell Off ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì•Œë¦¼ í—ˆìš© ì—¬ë¶€ë¥¼ ë¬»ëŠ” ì°½ì´ ëœ¸.
        
    - í—ˆìš©í•˜ë©´ granted ìƒíƒœê°€ ë˜ê³ , SubscribeUser í•¨ìˆ˜ê°€ í˜¸ì¶œë¨.
        
    

---

### **6. ì‚¬ìš©ìê°€ ì•Œë¦¼ì„ ê±°ë¶€í•œ ê²½ìš°**

- ì‚¬ìš©ìê°€ Blockì„ í´ë¦­í•˜ë©´ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ì—†ìŒ.
    
- ì‚¬ìš©ìê°€ ê±°ë¶€í•œ ì•Œë¦¼ì„ ë‹¤ì‹œ ìŠ¹ì¸í•˜ë ¤ë©´,
    
    - ì‚¬ìš©ìê°€ **ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ìˆ˜ë™ìœ¼ë¡œ ì•Œë¦¼ì„ í™œì„±í™”**í•´ì•¼ í•¨.
        
    

---

### **7. í‘¸ì‹œ ì•Œë¦¼ì„ êµ¬ë…(Subscription)í•˜ëŠ” ê³¼ì •**

- SubscribeUser í•¨ìˆ˜ê°€ ì‹¤í–‰ë¨.
    
- Service Workerê°€ ë“±ë¡ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œ í›„, Subscribe Endpointë¥¼ ìƒì„±í•¨.
    
- VAPID Keyê°€ í•„ìš”í•¨:
    
    - VAPID KeyëŠ” **ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ ê°„ì˜ ì¸ì¦ì„ ìœ„í•œ ê³µê°œí‚¤/ê°œì¸í‚¤ ìŒ**ì„.
        
    - ì´ í‚¤ë¥¼ í†µí•´ ì„œë²„ëŠ” íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ì—ë§Œ ì•Œë¦¼ì„ ì „ì†¡í•  ìˆ˜ ìˆìŒ.
        
    

---

### **8. VAPID Key ìƒì„±**

- web-push ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ VAPID Key ìƒì„± ê°€ëŠ¥.
    
    - ìƒì„± ì‹œ public keyì™€ private keyê°€ í•¨ê»˜ ìƒì„±ë¨.
        
    - public keyëŠ” í´ë¼ì´ì–¸íŠ¸ì— ì €ì¥í•˜ê³ , private keyëŠ” ì„œë²„ì—ì„œë§Œ ì‚¬ìš©í•´ì•¼ í•¨.
        
    

---

### **9. êµ¬ë… Endpoint ì €ì¥**

- ìƒì„±ëœ Subscription EndpointëŠ” notification í…Œì´ë¸”ì— ì €ì¥ë¨.
    
- ì´ë¥¼ í†µí•´ ì‚¬ìš©ìê°€ ìŠ¹ì¸í•œ ê¸°ê¸°ì—ì„œë§Œ í‘¸ì‹œ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ìˆë„ë¡ í•¨.
    

---

### **10. í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡**

- ì„œë²„ì—ì„œ web-push íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•´ í‘¸ì‹œ ì•Œë¦¼ì„ ì „ì†¡í•¨.
    
- ì•Œë¦¼ ì „ì†¡ ê³¼ì •:
    
    1. ì‚¬ìš©ì Endpointë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê°€ì ¸ì˜´.
        
    2. web-push.sendNotification() í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ì•Œë¦¼ ì „ì†¡.
        
    3. ì•Œë¦¼ ë©”ì‹œì§€ì—ëŠ” title, body, iconì´ í¬í•¨ë¨.
        
    

---

### **11. Service Workerì—ì„œ í‘¸ì‹œ ì•Œë¦¼ ìˆ˜ì‹ **

- Service Worker íŒŒì¼ ë‚´ì—ì„œ push ì´ë²¤íŠ¸ì™€ notificationclick ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•¨.
    
    - push ì´ë²¤íŠ¸: ì„œë²„ì—ì„œ ë³´ë‚¸ ì•Œë¦¼ì„ ìˆ˜ì‹ í•  ë•Œ íŠ¸ë¦¬ê±°ë¨.
        
    - notificationclick ì´ë²¤íŠ¸: ì‚¬ìš©ìê°€ ì•Œë¦¼ì„ í´ë¦­í–ˆì„ ë•Œ íŠ¸ë¦¬ê±°ë¨.
        
    

---

### **12. ì•Œë¦¼ ì´ë²¤íŠ¸ í•¸ë“¤ë§**

- push ì´ë²¤íŠ¸ì—ì„œ ì•Œë¦¼ ë©”ì‹œì§€ë¥¼ íŒŒì‹±í•˜ê³ , ì•Œë¦¼ì„ í‘œì‹œí•¨.
    
- notificationclick ì´ë²¤íŠ¸ì—ì„œ ì‚¬ìš©ìê°€ ì•Œë¦¼ì„ í´ë¦­í•˜ë©´, ì•±ì´ ì—´ë¦¬ë„ë¡ ì„¤ì •í•¨.
    

---

### **13. iOSì˜ ì œí•œì‚¬í•­**

- iOSì˜ ê²½ìš°, **ë²„ì „ 16.4 ì´ìƒë¶€í„° ì›¹ í‘¸ì‹œ ì•Œë¦¼ì„ ì§€ì›**í•¨.
    
- ì´ì „ ë²„ì „ì—ì„œëŠ” ì›¹ í‘¸ì‹œ ì•Œë¦¼ì´ ë™ì‘í•˜ì§€ ì•ŠìŒ.
    

---

### **14. ìµœì¢… êµ¬í˜„ ìš”ì•½**

- ì•Œë¦¼ì„ ìŠ¹ì¸í•˜ê±°ë‚˜ ê±°ë¶€í•  ìˆ˜ ìˆëŠ” ì»´í¬ë„ŒíŠ¸ êµ¬í˜„.
    
- PWAë¡œ ì•±ì„ ë³€í™˜í•˜ê³ , Service Workerë¥¼ ë“±ë¡í•¨.
    
- VAPID Keyë¥¼ í†µí•´ ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ ê°„ì˜ ì¸ì¦ì„ ì²˜ë¦¬í•¨.
    
- web-push íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡.
    
- push ì´ë²¤íŠ¸ì™€ notificationclick ì´ë²¤íŠ¸ë¥¼ í†µí•´ ì•Œë¦¼ê³¼ í´ë¦­ì„ ì²˜ë¦¬í•¨.
    

---

### **âœ…**Â 

### **ê²°ë¡  ë° í”¼ë“œë°±**

- ì´ ì˜ìƒì€ **PWAì™€ ì›¹ í‘¸ì‹œ ì•Œë¦¼ì˜ êµ¬í˜„ ê³¼ì •**ì„ ë§¤ìš° ì‹¤ìš©ì ì¸ ì˜ˆì œë¡œ ì„¤ëª…í•˜ê³  ìˆìŒ.
    
- iOS, Chrome ë“± **ë¸Œë¼ìš°ì €ë³„ ì œí•œì‚¬í•­**ê³¼ ê·¸ í•´ê²° ë°©ë²•ë„ í•¨ê»˜ ì œì‹œí•˜ì—¬ ì‹¤ì œ êµ¬í˜„ ì‹œ ë„ì›€ì´ ë  ë§Œí•œ ì •ë³´ê°€ ì˜ ì •ë¦¬ë˜ì–´ ìˆìŒ.
    
- VAPID Key ìƒì„±, Service Worker ë“±ë¡ ë“± **ë³´ì•ˆ ìš”ì†Œ**ì— ëŒ€í•œ ê°œë…ë„ ê°„ë‹¨íˆ ë‹¤ë£¨ê³  ìˆì–´, ì‹¤ë¬´ì—ì„œ ìœ ìš©í•˜ê²Œ í™œìš© ê°€ëŠ¥í•¨.
    

  

ì´ì œ ì´ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ **ì¡¸ì—… í”„ë¡œì íŠ¸ì—ë„ ì›¹ í‘¸ì‹œ ì•Œë¦¼ì„ ì ìš©**í•˜ê±°ë‚˜, ë” ë‚˜ì•„ê°€ **ì•Œë¦¼ ê´€ë¦¬ ê¸°ëŠ¥ì„ ê³ ë„í™”**í•˜ëŠ” ë°©ì•ˆì„ ìƒê°í•´ë³¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ğŸ‘ğŸ‘ğŸ‘ğŸ˜Š


ë„¤, ì œì•ˆí•˜ì‹  ê°œì„  ë°©í–¥ì€ ë§¤ìš° ì¢‹ìŠµë‹ˆë‹¤. ì¶”ê°€ì ì¸ ê°œì„ ì‚¬í•­ì„ ì œì•ˆë“œë¦¬ê² ìŠµë‹ˆë‹¤:

**1. ë©”ì‹œì§€ í ë° ë°°ì¹˜ ì²˜ë¦¬ ì¶”ê°€**

```java
@Service
public class MessageQueueService {
    private final Queue<Message> messageQueue = new ConcurrentLinkedQueue<>();
    private final int BATCH_SIZE = 100;
    
    @Scheduled(fixedRate = 100)
    public void processMessageBatch() {
        List<Message> batch = new ArrayList<>();
        messageQueue.drainTo(batch, BATCH_SIZE);
        
        if (!batch.isEmpty()) {
            processBatch(batch);
        }
    }
    
    private void processBatch(List<Message> batch) {
        Map<String, List<Message>> userMessages = batch.stream()
            .collect(Collectors.groupingBy(Message::getUserId));
            
        userMessages.forEach((userId, messages) -> {
            ConnectionState state = connectionManager.getConnection(userId);
            if (state != null && state.getSession().isOpen()) {
                sendBatchMessages(state.getSession(), messages);
            }
        });
    }
}
```

**2. ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ê°•í™”**

```java
@Service
public class PerformanceMonitor {
    private final Counter connectionCounter;
    private final Timer messageLatency;
    private final Gauge connectionGauge;
    
    @Scheduled(fixedRate = 60000)
    public void monitorConnections() {
        Map<String, Integer> stats = connectionManager.getStats();
        metricsService.recordConnectionStats(stats);
    }
    
    public void recordMessageLatency(long milliseconds) {
        messageLatency.record(milliseconds, TimeUnit.MILLISECONDS);
    }
}
```

**3. ì—ëŸ¬ ì²˜ë¦¬ ë° ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜**

```java
@Service
public class ErrorRecoveryService {
    private final Map<String, ErrorState> errorStates = new ConcurrentHashMap<>();
    
    @Data
    public static class ErrorState {
        private String userId;
        private int errorCount;
        private LocalDateTime lastError;
        private String errorType;
    }
    
    public void handleError(String userId, Exception e) {
        ErrorState state = errorStates.computeIfAbsent(userId, 
            k -> new ErrorState());
            
        state.setErrorCount(state.getErrorCount() + 1);
        state.setLastError(LocalDateTime.now());
        state.setErrorType(e.getClass().getSimpleName());
        
        if (state.getErrorCount() > MAX_ERROR_COUNT) {
            handleCriticalError(userId, state);
        }
    }
}
```

**4. ìƒíƒœ ìºì‹œ ì¶”ê°€**

```java
@Service
public class StateCache {
    private final Cache<String, WasherState> stateCache;
    
    public StateCache() {
        stateCache = CacheBuilder.newBuilder()
            .maximumSize(10000)
            .expireAfterWrite(5, TimeUnit.MINUTES)
            .build();
    }
    
    public WasherState getState(String washerId) {
        return stateCache.get(washerId, () -> 
            washerStateRepository.findById(washerId)
                .orElseThrow(() -> new WasherNotFoundException(washerId)));
    }
}
```

**5. ì—°ê²° í’€ ê´€ë¦¬**

```java
@Service
public class ConnectionPool {
    private final Map<String, ConnectionPool> pools = new ConcurrentHashMap<>();
    private final int MAX_POOL_SIZE = 1000;
    
    public WebSocketSession getConnection(String userId) {
        return pools.computeIfAbsent(userId, 
            k -> createNewPool()).getConnection();
    }
    
    private ConnectionPool createNewPool() {
        return new ConnectionPool(MAX_POOL_SIZE);
    }
}
```

**6. ë³´ì•ˆ ê°•í™”**

```java
@Component
public class WebSocketSecurityInterceptor implements HandshakeInterceptor {
    @Override
    public boolean beforeHandshake(ServerHttpRequest request,
                                 ServerHttpResponse response,
                                 WebSocketHandler wsHandler,
                                 Map<String, Object> attributes) {
        String token = extractToken(request);
        if (!authenticationService.validateToken(token)) {
            response.setStatusCode(HttpStatus.UNAUTHORIZED);
            return false;
        }
        return true;
    }
}
```

**7. ë¡œê¹… ì‹œìŠ¤í…œ**

```java
@Service
public class WebSocketLogger {
    private final Logger logger = LoggerFactory.getLogger(WebSocketLogger.class);
    
    public void logConnection(String userId, String event) {
        logger.info("Connection {}: {}", userId, event);
    }
    
    public void logError(String userId, Exception e) {
        logger.error("Error for user {}: {}", userId, e.getMessage());
    }
}
```

**8. ì„¤ì • ê´€ë¦¬**

```java
@Configuration
@ConfigurationProperties(prefix = "websocket")
@Data
public class WebSocketProperties {
    private long heartbeatInterval = 30000;
    private int maxReconnectAttempts = 5;
    private long initialBackoff = 1000;
    private int maxPoolSize = 1000;
    private int batchSize = 100;
}
```

ì´ëŸ¬í•œ ì¶”ê°€ ê°œì„ ì‚¬í•­ë“¤ì€:
1. ë©”ì‹œì§€ ì²˜ë¦¬ ì„±ëŠ¥ í–¥ìƒ
2. ì‹œìŠ¤í…œ ì•ˆì •ì„± ê°•í™”
3. ëª¨ë‹ˆí„°ë§ ë° ë””ë²„ê¹… ìš©ì´ì„±
4. ë³´ì•ˆ ê°•í™”
5. ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ ìµœì í™”

ë¥¼ ì œê³µí•  ê²ƒì…ë‹ˆë‹¤.
ë„¤, ì œì•ˆí•˜ì‹  ê°œì„  ë°©í–¥ì€ ë§¤ìš° ì¢‹ìŠµë‹ˆë‹¤. ì¶”ê°€ì ì¸ ê°œì„ ì‚¬í•­ì„ ì œì•ˆë“œë¦¬ê² ìŠµë‹ˆë‹¤:

**1. ë©”ì‹œì§€ í ë° ë°°ì¹˜ ì²˜ë¦¬ ì¶”ê°€**

```java
@Service
public class MessageQueueService {
    private final Queue<Message> messageQueue = new ConcurrentLinkedQueue<>();
    private final int BATCH_SIZE = 100;
    
    @Scheduled(fixedRate = 100)
    public void processMessageBatch() {
        List<Message> batch = new ArrayList<>();
        messageQueue.drainTo(batch, BATCH_SIZE);
        
        if (!batch.isEmpty()) {
            processBatch(batch);
        }
    }
    
    private void processBatch(List<Message> batch) {
        Map<String, List<Message>> userMessages = batch.stream()
            .collect(Collectors.groupingBy(Message::getUserId));
            
        userMessages.forEach((userId, messages) -> {
            ConnectionState state = connectionManager.getConnection(userId);
            if (state != null && state.getSession().isOpen()) {
                sendBatchMessages(state.getSession(), messages);
            }
        });
    }
}
```

**2. ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ê°•í™”**

```java
@Service
public class PerformanceMonitor {
    private final Counter connectionCounter;
    private final Timer messageLatency;
    private final Gauge connectionGauge;
    
    @Scheduled(fixedRate = 60000)
    public void monitorConnections() {
        Map<String, Integer> stats = connectionManager.getStats();
        metricsService.recordConnectionStats(stats);
    }
    
    public void recordMessageLatency(long milliseconds) {
        messageLatency.record(milliseconds, TimeUnit.MILLISECONDS);
    }
}
```

**3. ì—ëŸ¬ ì²˜ë¦¬ ë° ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜**

```java
@Service
public class ErrorRecoveryService {
    private final Map<String, ErrorState> errorStates = new ConcurrentHashMap<>();
    
    @Data
    public static class ErrorState {
        private String userId;
        private int errorCount;
        private LocalDateTime lastError;
        private String errorType;
    }
    
    public void handleError(String userId, Exception e) {
        ErrorState state = errorStates.computeIfAbsent(userId, 
            k -> new ErrorState());
            
        state.setErrorCount(state.getErrorCount() + 1);
        state.setLastError(LocalDateTime.now());
        state.setErrorType(e.getClass().getSimpleName());
        
        if (state.getErrorCount() > MAX_ERROR_COUNT) {
            handleCriticalError(userId, state);
        }
    }
}
```

**4. ìƒíƒœ ìºì‹œ ì¶”ê°€**

```java
@Service
public class StateCache {
    private final Cache<String, WasherState> stateCache;
    
    public StateCache() {
        stateCache = CacheBuilder.newBuilder()
            .maximumSize(10000)
            .expireAfterWrite(5, TimeUnit.MINUTES)
            .build();
    }
    
    public WasherState getState(String washerId) {
        return stateCache.get(washerId, () -> 
            washerStateRepository.findById(washerId)
                .orElseThrow(() -> new WasherNotFoundException(washerId)));
    }
}
```

**5. ì—°ê²° í’€ ê´€ë¦¬**

```java
@Service
public class ConnectionPool {
    private final Map<String, ConnectionPool> pools = new ConcurrentHashMap<>();
    private final int MAX_POOL_SIZE = 1000;
    
    public WebSocketSession getConnection(String userId) {
        return pools.computeIfAbsent(userId, 
            k -> createNewPool()).getConnection();
    }
    
    private ConnectionPool createNewPool() {
        return new ConnectionPool(MAX_POOL_SIZE);
    }
}
```

**6. ë³´ì•ˆ ê°•í™”**

```java
@Component
public class WebSocketSecurityInterceptor implements HandshakeInterceptor {
    @Override
    public boolean beforeHandshake(ServerHttpRequest request,
                                 ServerHttpResponse response,
                                 WebSocketHandler wsHandler,
                                 Map<String, Object> attributes) {
        String token = extractToken(request);
        if (!authenticationService.validateToken(token)) {
            response.setStatusCode(HttpStatus.UNAUTHORIZED);
            return false;
        }
        return true;
    }
}
```

**7. ë¡œê¹… ì‹œìŠ¤í…œ**

```java
@Service
public class WebSocketLogger {
    private final Logger logger = LoggerFactory.getLogger(WebSocketLogger.class);
    
    public void logConnection(String userId, String event) {
        logger.info("Connection {}: {}", userId, event);
    }
    
    public void logError(String userId, Exception e) {
        logger.error("Error for user {}: {}", userId, e.getMessage());
    }
}
```

**8. ì„¤ì • ê´€ë¦¬**

```java
@Configuration
@ConfigurationProperties(prefix = "websocket")
@Data
public class WebSocketProperties {
    private long heartbeatInterval = 30000;
    private int maxReconnectAttempts = 5;
    private long initialBackoff = 1000;
    private int maxPoolSize = 1000;
    private int batchSize = 100;
}
```

ì´ëŸ¬í•œ ì¶”ê°€ ê°œì„ ì‚¬í•­ë“¤ì€:
1. ë©”ì‹œì§€ ì²˜ë¦¬ ì„±ëŠ¥ í–¥ìƒ
2. ì‹œìŠ¤í…œ ì•ˆì •ì„± ê°•í™”
3. ëª¨ë‹ˆí„°ë§ ë° ë””ë²„ê¹… ìš©ì´ì„±
4. ë³´ì•ˆ ê°•í™”
5. ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ ìµœì í™”

ë¥¼ ì œê³µí•  ê²ƒì…ë‹ˆë‹¤.
