



**1. 세탁기 상태 관리 웹 대시보드**
• **세탁기 초기 화면**:
• **남자/여자/이불** 3가지중 선택
- 그 안에 **세탁기 탭** 또는 **건조기 탭**을 클릭하여 세탁기 이미지 모형이 나열됨.

-  **세탁기/건조기들 상태**: 세탁기 이미지들이 나열됨
	-  **빨간색 색상**: 돌리고 있을 때 (작동 중)
		- **남은 시간**: 세탁기 작동 남은 시간 표시.
	- 검은색 색상: 상태이상 신고된 세탁기
	- 색상없음: 사용가능한 세탁기

- **세탁기 클릭 시**: 
- 사용중이라면: 세탁
	- 세탁기이미지: 빨강색으로 물듬
	- 세탁기 작동 남은 시간 표시
	- 사용할시간 설정 안됨
	- 사용중 상태이상 신고
- 고장신고가 된 상태라면:
	- 세탁기이미지: 검정색
- 사용가능한 상태라면
	- 세탁기 사용 시간 설정하기 팝업생성버튼
	- 사용전 상태이상 신고생성버튼
	- 세탁물이 남아있다면(이전사용자 세탁물 빼놨다는 메세지 전송 여부 선택)
- 세탁기 사용시간 설정 팝업
	- **알림 설정**: 세탁기 종료 **몇 분 전 알림**을 받을지 설정.
		- 알림에 **도어스토퍼 설치 안내**: 세탁물가져가고 도어스토퍼설치해주세요~
	- 자신의 호실+개인정보를 선택
	- 세탁기 번호와 사용자를 매칭해 현재 사용중임을 기록.

- 프론트엔드: 최소한의 웹 UI
	- 알림: **초기에는 웹 기반 Service Worker + PWA 알림으로 간단하고 유지보수 쉬운 구조**로 시작하고, **나중에 확장 시에는 외부 메신저 API 연동(카카오톡, 밴드 등)** 으로 기능을 더할 수 있는 구조.
		- iOS는 PWA 홈화면 추가 유도 UX 구성
	- 회원가입: 기숙사측 계정연동
		- 기숙사 측에서 제공한 정보를 바탕으로 자동으로 아이디 비번을 생성하고, 로그인시 비밀번호를 변경하게 유도
	- 자동 로그인:  PWA + React에선 localStorage나 IndexedDB에 토큰 저장해서 자동 로그인 가능
		- 주의할점!
			- Localstorage는  JavaScript로 접근 가능하기 때문에, 사이트에 악성 스크립트가 삽입되면 탈취 가능
			- 토큰을 너무 오래 유지하지 않고, **Refresh Token 전략 사용**
			- XSS 방지를 위한 CSP(Content Security Policy) 설정

- 구조
	- 사용자 공간구조
		Institution(기관)
		 └─ Building (동)
		     └─ Unit (호실: 예. 305호)
		         └─ Room (세부 공간: 침대 1, 2, 3 등)
		             └─ User (사용자)
		- 이때 room에 사용권한, 비상시권한(선택)을 db에 저장해서 사용자가 속한 룸으로 권한을 가지게한다.
		- 세탁기가 고장난 등의 상황에 실제 권한을 서비스 계층에서 계산해 상태기반 응답을 한다.
	- 사용자테이블 구조
		- id
		- name
		- room_id
		- username(아이디)
		- password(암호화된 비번)

- 사용자기능

| **기능**         | **설명**                         |
| -------------- | ------------------------------ |
| ✅ 기기 상태 확인     | 사용 가능 / 사용 중 / 고장 상태 확인        |
| ✅ 사용 등록        | 빈 기기 선택 → 예상 사용 시간 입력 → 등록     |
| ✅ 사용 종료 / 회수   | 사용 후 완료 표시 → 회수 시간 기록          |
| ✅ 무단 사용 신고     | 비등록 상태 기기 사용 시 신고 가능           |
| ✅ 남은 시간 기록     | 무단 사용 중 기기에 남은 시간 수동 입력        |
| ✅ 알림 수신        | 예약 완료, 종료 임박, 공지 등 웹 알림 수신     |
| ✅ 알림 확인        | 접속 시 공지 팝업, 알림센터에서 확인          |
| ✅ 사용 내역 보기     | 자신의 등록 내역 및 회수 상태 확인           |
| ✅ 로그인 / 자동 로그인 | PWA에서 자동 로그인 (localStorage 기반) |

- 사용자 행동시나리오 기반 기능정리

| 사용자 행동              | 시스템 동작                                 | 관련 관리자 기능                         |
| ------------------- | -------------------------------------- | --------------------------------- |
| 기기 사용 시작            | 사용 등록 (예상 시간 입력) → 상태 `IN_USE` 전환      | 권한 확인 / 상태 기록 / 로그 저장             |
| 기기 사용 종료            | 사용 종료 버튼 → 회수 시간 자동입력 → 상태 `DONE`      | 회수율 반영 / 예약 통계 증가                 |
| 남이 무단 사용 중임         | 무단 사용 신고 → 상태 `SUSPECTED_IN_USE`       | 피신고자 기록 / 거짓신고 확인 / 경고 누적         |
| 내가 등록하지 않은 기기지만 돌아감 | 남은 시간 입력 → 상태 `IN_USE_UNREGISTERED`    | 관리자 확인 필요 알림 생성                   |
| 내 사용 내역 보기          | 사용 내역 조회 (상태/회수 포함)                    | 통계 반영, 사용자 활동 기록 열람               |
| 공지/알림 확인            | 접속 시 팝업 + 알림센터 내역 확인                   | 관리자 공지 작성/발송 로그 확인                |
| 고장신고                | 고장 신고 → 기기 상태 FAULT_REPORTED (신고 접수 중) | 관리자 접수 시 상태 FAULT_CONFIRMED 으로 전환 |
|                     |                                        |                                   |

---


    
- 관리자기능

|**기능**|**설명**|
|---|---|
|✅ 기기 등록 / 수정 / 삭제|공간 단위로 세탁기/건조기 관리|
|✅ 고장 처리|고장 신고 기기 수리 상태 변경|
|✅ 권한 설정 (Room → Location)|사용자 권한 배정 및 fallback/override 설정|
|✅ 사용자 관리|사용자 목록 필터링, 상태 확인|
|✅ 관리자 계정 관리|계정 생성 / 비활성화 / 역할 변경|
|✅ 알림 작성 및 발송|특정 사용자 또는 전체 대상 공지 발송|
|✅ 통계 확인|예약 수, 고장 수, 회수율 등 통계 확인|
|✅ 감사 로그 확인|관리자 행동 이력 확인 (AdminActionLog)|

- 관리자 행동흐름 기준 기능

|              |                                                         |
| ------------ | ------------------------------------------------------- |
| 관리자 행동       | 관련 기능 흐름                                                |
| 기기 설치        | 기기 등록 → 공간(Location) 지정 → 초기 상태 설정                      |
| 기기 고장 접수     | 고장 신고 상태 FAULT_REPORTED 확인 → 접수 시 상태 FAULT_CONFIRMED 변경 |
| 고장 처리 완료     | 상태 복구 (`AVAILABLE`) → 관리자 로그 기록                         |
| 사용자 권한 요청 처리 | Room → Location 권한 재배정 or override 설정                   |
| 회수율 모니터링     | 회수율/신고율/사용률 통계 확인 페이지 접속                                |
| 관리자 계정 관리    | 계정 생성/비활성화/역할 부여 → 상태/로그인 제한 적용                         |
| 정기 점검        | `last_login_at` 기준 미사용 관리자 파악 → 상태 변경 or 알림 발송          |
| 시스템 공지 작성    | Notification 생성 → 사용자 알림센터 + 팝업 전달                      |


---

## **🔁 공통 기능**

|**기능**|**설명**|
|---|---|
|✅ 로그인 / 인증 처리|JWT + role 기반 인증 처리|
|✅ 알림 수신 처리|PWA + Service Worker 알림 등록|
|✅ 권한 검사|role, institution_id 기반 API 접근 제어|
|✅ last_login_at 기록|로그인 시점 자동 업데이트|
|✅ 상태 동기화|예약 상태 자동 갱신 / 기기 상태 갱신 로직 포함|
- JWT 기반 로그인 + `role` 체크
    
- 모든 주요 테이블에 `institution_id` 포함 (멀티테넌시 구조)
    
- `AdminActionLog` 기록 구조 반영 (기기/권한/알림 관련 행동)
    
- 알림 구조: 웹 푸시 기반, 추후 카카오/밴드 등 확장 가능
    
- Soft Delete (`deleted_at`) 기반 삭제 설계 적용
 - 역할 기반 분리 예시

|**사용자 유형**|**기능 권한**|
|---|---|
|일반 사용자|사용 등록, 회수, 신고, 알림 확인|
|관리자 (MANAGER)|기기/고장/권한 관리, 일부 알림 가능|
|최고 관리자 (SUPER_ADMIN)|모든 권한, 계정 생성/관리, 감사 로그 확인|

  
### 📊 상태 흐름 및 조건 정의

| 상태                 | 전이 조건                    | 설명                          |
| ------------------ | ------------------------ | --------------------------- |
| `AVAILABLE`        | 초기 상태 / 회수 완료 / 수리 완료    | 기기가 사용 가능함                  |
| `IN_USE`           | 사용자가 사용 등록 후 시작 버튼 누름    | 사용 중, 등록자만 회수 가능            |
| `DONE`             | 사용 종료 조건 만족 (예상 시간 도달 등) | 사용 종료 예정 상태, 회수 대기 중        |
| `UNREGISTERED_USE` | 등록되지 않은 사용이 감지됨 (신고)     | 무단 사용 상태로 표시됨               |
| `FAULT_REPORTED`   | 사용자 고장 신고                | 신고 접수 전 상태, 알림 생성됨          |
| `FAULT_CONFIRMED`  | 관리자가 고장 접수               | 수리 대기 상태, 사용자에겐 사용 불가 표시    |
| `REPAIRED`         | 관리자가 수리 완료 처리            | 다시 사용 가능 (`AVAILABLE`)로 전이됨 |

---

### 🖥️ 사용자/관리자 UI 및 행동 흐름

|   |   |   |
|---|---|---|
|상태|사용자 UI 요소|관리자 UI 요소|
|`AVAILABLE`|사용 등록 가능, 예상 시간 입력|상태 확인, 수정 가능|
|`IN_USE`|종료 버튼 표시 (등록자에게만)|남은 시간 확인 / 무단 사용 여부 판단|
|`DONE`|회수 버튼 표시 / 회수 안내|회수율 통계 증가, 회수 확인 필요, 회수 시간 기록 자동 저장|
|`UNREGISTERED_USE`|상태표시만, 신고 버튼 표시|수동 시간 기록 확인 / 신고 분석|
|`FAULT_REPORTED`|사용 불가 표시, 알림 있음|"고장 접수" 버튼 활성화|
|`FAULT_CONFIRMED`|사용 불가 표시|"수리 완료" 버튼 표시 / 이력 추가 가능|
|`REPAIRED`|사용 가능 상태로 복귀|이력 확인만 가능|

---

### 🔔 알림 흐름

|   |   |   |
|---|---|---|
|트리거|대상|내용|
|사용 등록|사용자|"사용 등록 완료되었습니다."|
|종료 5분 전|사용자|"곧 종료됩니다. 회수를 준비해주세요."|
|고장 신고 접수됨|관리자|"기기 고장 신고가 접수되었습니다."|
|고장 처리 완료|사용자|"기기 수리가 완료되어 사용 가능합니다."|
|무단 사용 신고됨|관리자|"기기 무단 사용 신고가 접수되었습니다."|

---

### 📈 회수 기록 및 통계 흐름

- 사용자가 회수 버튼을 누르면 회수 시간 자동 기록됨
    
- 관리자는 각 기기별로 일일/주간 기준 사용자 이용 목록 및 회수 여부 확인 가능
    
- 통계 페이지 또는 기기 상세 화면에서 확인 가능 (예: 회수율, 미회수 내역, 반복 무단 사용자 등)